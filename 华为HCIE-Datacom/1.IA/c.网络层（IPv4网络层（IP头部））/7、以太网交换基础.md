```
以太网交换基础
```
 
```
路由：路径由来
```
 
```
交换：交互替换
```

```
以太网协议：通过以太网链路（网线）连接设备
```
 
```
以太网卡：是网络设备连接外部的必要部件  
          每一个网络设备都至少存在一个网卡
```
 
```
以太网卡收到bit流后，会将其转换为数字信息
```

```
应用层  数据
```
 
```
传输层  数据段
```
 
```
网络层  数据包
```
 
```
数据链路层 数据帧
```
 
```
物理层  bit流
```

```
数据帧格式：  
1.以太网Ⅱ帧  
   1.DMAC 6字节  
   2.SMAC 6字节  
   3.type：2字节，表明上层协议的（IP 0x0800、ARP 0x0806）  
   4.fcs：4字节，校验
```
 
```
2.802.3帧  
   LLC、org code 都为固定值  
   type：表明上层协议的（IP 0x0800、ARP 0x0806）
```
   

```
以太网Ⅱ格式帧 一般用于访问数据封装使用
```
 
```
802.3格式帧 一般用于协议交互封装使用
```

![Exported image](Exported%20image%2020251206145627-0.png)

```
数据帧的最小值为64字节   是为了防止电信号冲突  
数据帧的最大值为1518字节 以太网口最大处理数据单位为  
1500（数据包的大小）
```
 
```
1.数据帧的总长度为64-1518字节，这样设计的原因是什么？（另  
外，以太网口的最大传输单元是1500字节，即MTU=1500 Byte。）  
    以太网中，最小帧长为64字节，这是由最大传输距离和CSMA/CD机制共同决定的。  
  规定最小帧长是为了避免这种情况发生：A站点已经将一个数据包的最后一个Bit发送完毕，但这个报文的第一个Bit还没有传送到距离很远的B站点。B站点认为线路空闲继续发送数据，导致冲突。  
  高层协议必须保证Data域至少包含46字节，这样加上以太网帧头的14字节和帧尾的4字节校验码正好满足64字节的最小帧长，如  
果实际数据不足46个字节，则高层协议必须填充一些数据单元。  
而出于对传输效率和传输可靠性的折中考虑，使得以太网帧的最大  
长度为1518字节，对应IP数据包就是1500字节。  
较大的帧长度，数据的有效传输效率会更高；但是数据帧过长，传输时会占用共享链路过多的时间，对时延敏感应用造成极大的影响。  
因此最终选择了一个折中的长度：1518字节的数据帧长，对应  
1500字节的IP数据包长度，这就是最大传输单元MTU的由来。
```

```
MAC地址：
```

```
MAC地址：  
是每一个网卡都会存在的一个地址  
MAC地址是全球唯一的
```

```
MAC地址描述：  
1.MAC地址长度为 48bit（6字节）  
2.MAC地址的表示：  
   1.二进制表示  
   2.十六进制- 表示
```
 
```
二进制和十六进制的转换关系：  
一个十六进制数 由 4个二进制数转换得到
```
 
```
二进制转换为十六进制：  
  和二进制转换为 十进制的 加法计算 相同  
  最小的十六进制数： 0000   0  
  最大的十六进制数： 1111   F
```

```
MAC地址的构成：  
1.OUI：厂商代码，由机构给厂商分配 24bit  
2.流水编号：24bit 
```

```
MAC地址分类：  
1.单播MAC：地址的第8bit为0  
00000000-0000-0000-0000-0000-0000  
    实现一对一的通信
```
 

==2.组播MAC：地址的第8bit为1，其他的bit不全为1  ==
00000001-0000-0000-0000-0000-0000  
    实现一对多的通信
```
 
```
3.广播MAC：所有bit都为1  
    实现一对所有的通信
```

```
[S1]display mac-address  查看设备的MAC地址表项  
MAC address table of slot 0:  
-------------------------------------------------------------------------------  
MAC Address    VLAN/       PEVLAN CEVLAN Port            Type      LSP/LSR-ID    
               VSI/SI                                              MAC-Tunnel    
-------------------------------------------------------------------------------  
5489-9811-1111 1           -      -      GE0/0/1         dynamic   0/-           
5489-9822-2222 1           -      -      GE0/0/2         dynamic   0/-           
-------------------------------------------------------------------------------  
Total matching items on slot 0 displayed = 2 
```

```
终端访问数据到交换机后，交换机通过MAC地址表项执行数据的转发   
设备初始情况，MAC地址表项为空
```

```
MAC地址表项的生成：  
1.动态生成：  
   自动生成，存在老化时间300s  
   MAC地址如果在其他接口存在，则表项会自动替换为新的接口  
   终端发送的报文携带SMAC 和 DMAC  
   交换机收到终端的报文，将接收报文的接口 和 报文的SMAC 做对应，记录为MAC表项
```
 
```
2.静态生成：  
   手工配置，不会老化，只能手工删除  
   在其他接口收到静态配置的MAC数据，直接丢弃  
   [S1]mac-address static 5489-9833-3333 gi 0/0/3 vlan 1   配置静态MAC地址
```
 
```
   [S1]mac-address blackhole 5489-9844-4444 vlan 1  配置黑洞MAC  
   被黑洞MAC匹配的数据，直接丢弃
```

```
交换机的处理行为：  
1.转发：数据匹配了交换机的MAC地址表项，根据表项发送数据
```
 
```
2.丢弃：数据匹配了黑洞MAC，或错误匹配了静态MAC
```
 
```
3.泛洪：交换机收到 未知单播帧、组播帧、广播帧，执行泛洪  
        将数据从接收接口以外的其他所有接口转发
```

```
交互过程：  
1.终端发起ARP解析  
2.交换机收到 arp request，记录SMAC和接口的对应关系  
3.交换机通过泛洪行为，发送arp request报文  
4.其他终端收到报文，被访问的设备回复arp reply报文  
5.交换机收到arp reply报文，记录SMAC和接口的对应关系  
6.交换机根据MAC地址表转发arp reply（转发行为）
```