```
AS：自治系统  
aAS指的是在同一个组织管理下，使用统一选路策略的设备集合  
可以将一个公司、园区、数据中心当作一个AS
```
 
```
AS编号初始定义长度为16bit  
随着网络的发展，16bit的长度不够使用了，扩展为了32bit  
现在所有网络设备的BGP都是默认32bit的长度
```
 
```
在长度为16bit的AS号表示方式中：64512-65534为私有AS号  
在长度为32bit的AS号表示方式中：4200000000-4294967294为私有AS号
```
 
```
AS的配置方式：  
1.数字表示：取值范围是0-4294967294  
2.AA.NN表示：取值范围是0-65534.0-65534
```
 
```
每一台设备都只能配置一个BGP的AS号
```
 
```
AS之间使用IGP传递路由信息的问题？  
1.需要交互拓扑信息，暴露自身AS内的拓扑结构(不安全)  
2.IGP承载的路由信息条目有限
```
 
```
AS之间使用BGP传递路由信息的优点：  
1.BGP基于TCP，只要能够建立TCP连接即可建立BGP。  
2.只传递路由信息，不会暴露AS内的拓扑信息。                                                 [rip协议周期性更新路由信息，只传递路由信息]  
3.触发式更新，而不是进行周期性更新。
```
 
```
EGP：外部网关协议
```
 
```
BGP：边界 网关协议  
1.基于TCP 协议建立（端口号179） （BGP会更加安全、可靠）                            [OSPF基于IP协议建立邻居，ISIS基于数据链路层建立]  
2.触发式更新，不是周 期性更新   （BGP邻居建立后只会通告给邻居 新增加的 或 需要删除 的路由条目）  
3.BGP能够承载大批量的路由信息，能够支撑大规模网络  
4.BGP为路由信息提供了丰富的路由属性 （BGP路由不止存在 优先级、开销值、下一跳、出接口等属性，还具备其他路由属性）  
5.BGP提供路由聚合的能力，存在路由衰减的功能保障网络的稳定性
```
   

```
BGP的特征：  
1.运行BGP的设备（BGP 发言者、BGP 路由器）  
2.BGP对等体：BGP路由器之间交互BGP会话形成BGP邻居  
3.BGP路由携带的路径属性（路由属性），可以用于路由信息的优选
```
  ![Exported image](Exported%20image%2020251206164533-0.png)   
```
BGP对等体邻居的类型：  
1.IBGP邻居：一个AS内建立的BGP邻居关系
```
 
```
2.EBGP邻居：AS之间建立的BGP邻居关系
```
 
```
#  
bgp 100  
 #  
 ipv4-family unicast  
  undo synchronization   撤销同步
```
 
```
通过直连地址建立IBGP邻居关系  
[AR1]bgp 100  
[AR1-bgp]peer 10.1.12.2 as-number 100   指定建立会话的IP与AS编号  
该命令配置完成后，会在ipv4单播地址簇下自动生成一个使能邻居建立的功能
```
 
```
注：  
因为TCP是单播通信的，所以只要地址可达就能够进行TCP建立，  
TCP能够正常建立那BGP就可以正常建立￼  
通过设备的环回口地址建立IBGP邻居关系￼环回口建立的优势：相比于物理接口更加稳定  
[AR1-bgp]peer 2.2.2.2 as-number 100   
[AR1-bgp]peer 2.2.2.2 connect-interface LoopBack 0 
```
 
```
通过直连地址建立EBGP邻居关系  
[AR3]bgp 100   
[AR3-bgp]peer 10.1.34.4 as-number 200  
因为AS之间没有IGP的运行，所有EBGP邻居之间只存在直连路由  
所以EBGP邻居之间交互的报文TTL值都为1
```
 
```
通过环回口建立EBGP邻居关系  
环回口事先通过静态或IGP打通  
[AR3]bgp 100  
[AR3-bgp]peer 4.4.4.4 as-number 200   
[AR3-bgp]peer 4.4.4.4 connect-interface LoopBack 0  
[AR3-bgp]peer 4.4.4.4 ebgp-max-hop 2  设置EBGP邻居的最大跳数为2
```
   

```
如图拓扑：理想情况是：AS内部使用IBGP+IGP，AS之间使用EBGP。￼现在出现以下疑问：￼1.AR3和AR4，AR1和AR6之间通过EBGP连接，AS内部使用IGP就能互相通信；边界路由器可以互相引入对端的路由协议、再过滤，便可以互相通信，那干嘛还需要再内部使用IBGP?￼  
答案：￼1.在AS内部使用 IBGP 的目的不是给内部网络使用的，而是为了方便不同AS之间互相访问用的。￼2.虽然可以通过：边界路由器互相引入对端的路由协议、再进行过滤，可以达到互相通信的效果，但是实际应用中，AS200 要去访问AS300，需要通过AS100，如果使用引入的方法，会让AS300 与AS200内存在AS100 的IGP路由信息，这并不是我们想要的，而且如果AS100作为中间件过多，那么AS100内部的路由信息非常庞大，操作十分繁琐，且麻烦。￼3.如下：再AS内部使用IBGP，的作用类似与桥梁。
```

![Exported image](Exported%20image%2020251206164535-1.png)