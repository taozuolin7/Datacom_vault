```
控制平面  
  对于路由信息的学习  
  路由过滤（filter-policy 、 filter）  
  route-policy 路由策略
```
 
```
转发平面  
  对于数据信息的转发  
  流量过滤（traffic-filter）  
  PBR 策略路由
```
   

```
**先有控制平面，才有转发平面
```
 
```
路由策略并非单一的技术或者协议，而是一个技术专题或方法论，里面包含了多种工具及方法。
```
 
```
路由管理可以在以下时段执行：  
控制路由的发布：通过路由策略对发布的路由进行过滤，只发布满足条件的路由。  
控制路由的接收：通过路由策略对接收的路由进行过滤，只接收满足条件的路由。  
控制路由的引入：通过路由策略控制从其他路由协议引入的路由条目，只有满足条件的路由才会被引入
```
 
```
对于路由信息的管理：  
1.需要匹配工具  
    1.ACL：访问控制列表  
        1.可以匹配流量（默认动作允许所有）  
        2.可以匹配路由（默认动作拒绝所有）  
           只能将网络地址作为参数进行匹配
```
 
```
    2.ip-prefix  
        只能匹配路由信息，不能匹配流量  
        [AR1]ip ip-prefix test index 5 permit 1.1.1.1 32   
             greater-equal  大于等于（指定的掩码参数）  
             less-equal     小于等于（指定的掩码参数）  
        匹配路由信息时，可以匹配网络地址 和 网络掩码  
        匹配路由信息时，默认动作拒绝所有  
        前缀列表匹配时，按照index值从小到大依次匹配，匹配后不在继续向下匹配  
2.需要执行工具  
    1.filter-policy  
    2.route-policy
```

```
两种方式都可以匹配路由   
 在1.1.1.0/24范围内，匹配所有的掩码大于等于25位的路由  
#  
ip ip-prefix test index 5 permit 1.1.1.0 24  greater-equal 25 less-equal 32
```
 
```
#  
acl 2000  
 rule 5 permit source 1.1.1.1 0  
 rule 15 permit source 1.1.1.2 0   
 rule 25 permit source 1.1.1.3 0 
```

```
[AR1]ip ip-prefix test index 100 permit 0.0.0.0 0      匹配默认路由 允许通过
```
 
```
[AR1]ip ip-prefix test index 100 permit 0.0.0.0 0 greater-equal 0 less-equal 32   匹配所有路由 允许通过
```

```
执行工具：  
1.filter-policy  
   过滤策略，只具备匹配路由后的过滤功能  
2.route-policy  
   路由策略，具备管理路由的能力（过滤、修改属性、添加属性、删除属性等）  
   [AR1]route-policy test permit/deny node \<0-65535\> 创建路由策略  
   路由策略通过一系列的节点组成，节点之间是 或 的关系，从小到大依次匹配  
   [AR1]route-policy test permit node 10      
         每一个节点内 都具备 条件语句  和 执行语句  
         如果存在多个条件语句，则条件语句之间是 与 的关系  
         如果存在多个执行语句，则执行语句之间是 与 的关系  
           
   [AR1]route-policy test permit node 20  
         如果节点内不存在条件语句，则表示匹配所有信息  
         如果节点内不存在执行语句，则表示不需要执行操作
```
 
```
   [AR1]route-policy test deny node 30
```
 
```
   路由策略存在默认的节点，该节点的动作为拒绝所有
```

![Exported image](Exported%20image%2020251206164642-0.png)  

```
要求AR1学习到的OSPF外部路由优先级值改为50  
  [AR1-ospf-1]preference ase 50   
要求AR1学习到的OSPF外部路由 掩码大于等于28 小于等于32的 优先级值改为30  
  [AR1]ip ip-prefix test index 10 permit 2.2.2.0 24 greater-equal 28 less-equal 32
```
 
```
  [AR1]route-policy test permit node 10  
  [AR1-route-policy]if-match ip-prefix test   
  [AR1-route-policy]apply preference 30
```
 
```
  [AR1]route-policy test permit node 1000
```
 
```
  [AR1]ospf  
  [AR1-ospf-1]preference ase 50 route-policy test
```

```
路由条目的优先级值是一个本地的概念，在使用route-policy 进行匹配修改的时候，并不能修改到，外部路由的优先级值还是150
```

![Exported image](Exported%20image%2020251206164644-1.png)

```
匹配工具 和  执行工具 动作交互的最终处理：
```
 
```
匹配工具     执行工具         最终动作  
permit       permit           在节点匹配，允许通过，不需要进行下一节点的匹配  
permit       deny             在节点匹配，拒绝通过，不需要进行下一节点的匹配  
deny         permit           在节点匹配，拒绝通过，需要进行下一节点的匹配  
deny         deny             在节点匹配，拒绝通过，需要进行下一节点的匹配
```

```
#（动作1）  
ospf 1 router-id 10.5.5.5   
 import-route static route-policy test  
￼（匹配工具）  
#  
acl number 2000    
 rule 5 permit source 192.168.5.1 0   
#  
acl number 2001    
 rule 5 deny source 192.168.5.2 0   
#  
ip ip-prefix test in 10 permit 192.168.5.3 32   
#  
ip ip-prefix test in 20 deny 192.168.5.4 32  
#  
（路由策列）  
route-policy test permit node 10   
 if-match acl 2000   
#  
route-policy test deny node 20   
 if-match acl 2001   
#  
route-policy test deny node 30   
 if-match ip-prefix test   
#  
route-policy test permit node 40   
 if-match ip-prefix test   
#  
route-policy test permit node 100   
（匹配所有，动作允许）￼
```

![Exported image](Exported%20image%2020251206164648-2.png)

```
如图：路由策列是如何执行的？（笔试论述题）￼1.以路由为起点：192.168.5.1/32 在（动作1）被引入内部  
  1.2.根据（路由策列） 从结点最小值开始判断：  
Node 10 匹配acl 2000，2000正好是192.168.5.1/32 的匹   配工具，动作是允许，node 10的动作也是允许，直接放行，不用再往下匹配
```
 
```
2.再继续看192.168.5.2/32在（动作1）被引入内部￼  2.1根据路由策列）从节点最小值开始判断：
```

```
Node 10 匹配acl 2000，2000对于192.168.5.2/32动作是拒绝；匹配工具=拒绝，node10=允许，即进行下一节点的匹配
```

```
Node 20 匹配acl2001，2001正好匹配192.168.5.2/32，动作是拒绝；匹配工具=拒绝，node20=deny，即进行下一节点的匹配
```

```
Node 30 匹配192.168.5.3/32，不匹配192.168.5.2/32
```

```
所以动作是拒绝；匹配工具=拒绝，node30=拒绝，即进行下一节点的匹配
```

```
Node 40 匹配的是192.168.5.4/32，动作拒绝，默认动作也是拒绝；匹配工具=拒绝，node 40=拒绝，即进行下一节点的匹配
```

```
Node 100 没有动作，默认为匹配所有；匹配工具=允许，node 100=允许，即为允许，不再进行下一节点的匹配。
```

```
所有最终结果为允许192.168.5.2/32。￼
```