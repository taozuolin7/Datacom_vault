**1.****前言**￼RFC定义了VLAN扩展方案VXLAN  
（Virtual eXtensible Local Area Network，虚拟扩展局域网）。  
VXLAN采用MAC in UDP封装方式，NVO3  
（Network Virtualization over Layer 3）中的一种网络虚拟化技术。
 
**2.****V****x****LAN及园区网络虚拟化技术背景**  
背景： 虚拟化技术具有降低IT成本、提高业务部署灵活性和降低运维成本等优势。  
新需求1：二层扩展  
服务器虚拟化后，业务被封装在虚拟机中。虚拟机允许在集群内任意主机中热迁移。  
热迁移的特性之一是网络状态不改变，这要求在不同的物理位置中虚拟机的IP地址保持不变，为此需要大二层网络解决此问题。  
新需求2：多租户隔离  
租户间隔离：租户可能配置相同的MAC和IP地址，需要考虑物理网络承载隔离的问题，并且存在海量的用户需要进行隔离。  
租户内互访：租户内相同网段能够直接进行二层通信，即便处于不同物理位置的机房中。
 
**3.****传统网络的缺陷**  
虚拟机规模受设备表项规格限制  
服务器虚拟化后，VM的数量比原有的物理机发生了巨大的增长，而接入侧二层设备的MAC地址表规格较小，无法满足快速增长的VM数量。  
网络隔离能力限制  
VLAN Tag只有12 bit  
虚拟机迁移范围受限  
虚拟机迁移必须发生在一个二层网络中。  
传统的二层网络，将虚拟机迁移限制在了一个较小的局部范围内。

**VXLAN****的基本概念及工作原理**  
**1.VXLAN****简介：**  
本质：VPN技术**￼**能够在任意路由可达的**物理网络（****Underlay****网络）**上叠加**二层虚拟网络（****Overlay****网络）**，通过VXLAN网关之间的VXLAN隧道实现VXLAN网络内部的互通，  
同时，也可以实现与传统的非VXLAN网络的互通。  
VXLAN通过采用MAC in UDP封装来延伸二层网络，将以太报文封装在IP报文之上，通过路由在网络中传输，无需关注虚拟机的MAC地址。  
且三层网络无网络结构限制，具备大规模扩展能力。通过路由网络，虚拟机迁移不受网络架构限制。
 
**Underlay网络：即物理网络，作为构架上层逻辑网络的基层。**  
**Overlay网络：在物理网络上通过隧道技术搭建的逻辑网络。**
 
**2.****VXLAN解决传统网络遇到的问题：**  
虚拟机规模受网络规格限制：  
VXLAN将虚拟机发出的数据包封装在UDP中，并使用物理网络的IP、MAC地址作为外层头进行封装，对网络只表现为封装后的参数。  
除VXLAN**网络边缘设备**，网络中的其他设备不需要识别虚拟机的MAC地址，减轻了设备的MAC地址学习压力，提升了设备性能。  
网络隔离能力限制：  
VXLAN引入了类似VLAN ID的用户标识（VNI），由24 bit组成，支持多达16 M（16777216）的VXLAN段的网络隔离，对用户进行隔离和标识不再受到限制，  
可满足海量租户。  
虚拟机迁移范围受网络架构限制：  
对于具有同一网段IP地址的VM而言，即使其物理位置不在同一个二层网络中，但从逻辑上看，相当于处于同一个二层域。  
即VXLAN技术在三层网络之上，构建出了一个虚拟的大二层网络。
 
**3.****VXLAN在数据中心的应用**  
在数据中心中采用**Spine-Leaf两层物理架构**，结合VXLAN应用。  
Spine节点执行路由转发，转发时不感知VXLAN。Leaf节点负责资源接入，完成VXLAN封装及解封装。  
数据中心的业务均由VXLAN承载。

![Exported image](Exported%20image%2020251206151913-0.png)  

**4.****在园区网络中使用VXLAN实现“一网多用”**

![Exported image](Exported%20image%2020251206151916-1.png)  

**5.****为什么选择VXLAN实现园区网络虚拟化**

![Exported image](Exported%20image%2020251206151917-2.png)  

**6.****VXLAN的报文格式**

![Exported image](Exported%20image%2020251206151919-3.png)