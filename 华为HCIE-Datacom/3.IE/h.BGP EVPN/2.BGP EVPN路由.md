# **Type 2类路由描述**  
Type 2路由（MAC/IP路由）：主要用于==MAC地址通告==、==ARP信息通告==以及==主机IP路由通告==。
![](assets/2.BGP%20EVPN路由/file-20251212174026961.png)

**在不同场景下，BGP EVPN的Type 2路由携带的内容并不一致。**
![](assets/2.BGP%20EVPN路由/file-20251212174122857.png)  

## **1.主机MAC地址通告**
![](assets/2.BGP%20EVPN路由/file-20251212174145532.png)
  

## **2.主机ARP通告**
![](assets/2.BGP%20EVPN路由/file-20251212180736395.png)
**3.分布式网关下的跨子网通信**  
分布式网关组网中VTEP设备既是L2网关，又是L3网关。在该组网下跨子网通信的实现方式并不唯一，根据接收报文的VTEP（Ingress VTEP）处理方式不同，可以划分为：  
非对称IRB转发（Asymmetric Integrated Routing and Bridging）  
对称IRB转发（Symmetric Integrated Routing and Bridging）

Ingress VTEP：流量进入VXLAN网络的VTEP设备。
Egress VTEP：流量从VTEP离开VXLAN网络的设备。

**①非对称IRB转发**  
非对称IRB转发：Ingress VTEP同时执行L3、L2查表转发，Egress VTEP只需要进行L2查表、转发，因为Ingress、Egress所执行操作不一致，被称为非对称转发。
![](assets/2.BGP%20EVPN路由/file-20251212181421009.png)

**②对称IRB转发**  
对称IRB转发：Ingress VTEP、Egress VTEP都执行L3查表转发。
相比较于非对称IRB转发，新增了一个IP VPN实例以及其所绑定的L3 VNI概念（非对称IRB转发时VTEP之间传输的报文其VXLAN头部中VNI值为L2 VNI），VBDIF接口需要绑定IP VPN实例，此时该VBDIF接口的路由学习、数据转发都被限制在该IP VPN实例中，与MPLS VPN类似。
![](assets/2.BGP%20EVPN路由/file-20251212182105906.png)

**EVPN** **RT、IP VPN RT**  
新增IP VPN实例之后，BGP EVPN在传递Type 2路由时携带的RT值依旧是EVPN RT值，只是对端收到路由之后的处理行为存在区别：  
检查该路由携带的RT，如果与本端EVPN实例的Import RT相同，则接收该路由。EVPN实例获取到IRB类型路由后，还能提取到其中包含的ARP类型路由，用于主机ARP通告。  
检查该路由携带的RT，如果与本端IP VPN实例的Import RT（EVPN）相同，则接收该路由。然后，VPN实例获取到该路由携带的IRB类型路由，从中提取的主机IP地址、三层VNI，在其路由表中保存主机IP路由，并根据路由的下一跳迭代出接口，最终迭代结果是指向VTEP的VXLAN隧道。
 
**只有当路由携带的RT值与EVPN IRT、IP VPN IRT（EVPN）都不相同时，该路由才会被丢弃。**
![](assets/2.BGP%20EVPN路由/file-20251212183110776.png)   
## **对称IRB转发：主机IP路由通告 (IRB路由)**
![](assets/2.BGP%20EVPN路由/file-20251212183144381.png)  

**对称IRB转发：通信过程**
![](assets/2.BGP%20EVPN路由/file-20251212184036643.png)  

# **Type 3类路由描述**  
Type 3路由（Inclusive Multicast路由）：  
该类型路由在VXLAN控制平面中主要用于==VTEP的自动发现==和==VXLAN隧道的动态建立==。  
作为BGP EVPN对等体的VTEP，通过Inclusive Multicast路由互相传递二层VNI和VTEP IP地址信息。  
其中，Originating Router's IP Address字段为本端VTEP IP地址，MPLS Label字段为二层VNI。
![](assets/2.BGP%20EVPN路由/file-20251212184327136.png)

**PMSI：Provider Multicast Service Interface(提供者组播服务接口)，一个可选过渡的BGP属性，在VXLAN场景中Tunnel Type固定为6，**  
**用来携带发送端的VTEP IP地址、L2 VNI。**
 
**建立VXLAN隧道**  
VTEP通过Type 3路由互相传递二层VNI和VTEP IP地址信息。如果对端VTEP IP地址是三层路由可达的，则建立一条到对端的VXLAN隧道。  
同时，如果对端VNI与本端相同，则创建一个头端复制列表，用于后续BUM报文转发。
![](assets/2.BGP%20EVPN路由/file-20251212191459341.png)

**Type 5类路由描述**  
Type 5路由（IP前缀路由）：  
该类型路由的IP Prefix Length和IP Prefix字段既可以携带主机IP地址，也可以携带网段地址。  
当携带主机IP地址时，该类型路由在VXLAN控制平面中的作用与IRB类型路由是一样的，主要用于分布式网关场景中的==主机IP路由通告==。  
当携带网段地址时，通过传递该类型路由，可以实现VXLAN网络中的==主机访问外部网络==。
![](assets/2.BGP%20EVPN路由/file-20251212191551602.png)

**通告IP前缀路由的应用场景**  
对于VXLAN外部网络，VTEP可以通过Type 5类路由将外部路由通告到整个VXLAN网络中，用于指导VXLAN内部主机访问外部网络。
