# **ARP广播抑制**  
BGP EVPN的Type 2路由使得VTEP可以不依赖主机之间的通信过程完成MAC地址表的学习，但是主机间的ARP信息依旧需要在VXLAN Overlay中进行泛洪转发，这会占用大量的网络资源。  
为此可以通过BGP EVPN路由实现ARP广播抑制功能，减少广播流量。
![](assets/3.BGP%20EVPN特性/file-20251212192752848.png)  
==•ARP广播抑制功能是一种有效缓解网关处理ARP报文的压力的方法。==
当网关收到ARP请求报文时，会查询==ARP广播抑制表==，该表保存了目的设备的IP与MAC地址的映射关系，如果命中表项，则直接将ARP请求报文中的广播MAC地址替换为目的设备的MAC地址，随后网关将ARP请求报文从目的MAC对应的端口发送出去。
# **主机信息收集**  
ARP广播抑制功能的实现==依赖于ARP广播抑制表==，该表项的形成依赖于BGP EVPN携带的Type 2路由（IRB路由、主机ARP通告）。  
==默认情况下L3网关不会由本地的ARP信息生成BGP EVPN路由，需要手动使能BGP EVPN主机信息收集功能。  ==
之后VTEP会依据ARP信息生成IRB路由。
![](assets/3.BGP%20EVPN特性/file-20251212193307688.png)

ARP类型路由携带的有效信息有：主机MAC地址+主机IP地址+二层VNI；  
IRB类型路由携带的有效信息有：主机MAC地址+主机IP地址+二层VNI+三层VNI。  
==因此，IRB类型路由包含着ARP类型路由，不仅可以用于主机IP路由通告，也能用于主机ARP通告。==
 
# **本地ARP代理**  
全网开启BGP EVPN主机信息收集功能之后，L3网关上将学习到全部主机的32位主机路由，这使得L3网关在转发属于同一个BD之间的流量时完全可以依赖主机路由进行三层IRB对称转发。
为此可以在L3网关的VBDIF接口上开启本地ARP代理，VBDIF接口会响应下连主机对同网段IP地址的ARP请求，之后对该同网段IP的访问可以由L3网关进行三层转发完成。

![Exported image](Exported%20image%2020251206152050-2.png)  
![Exported image](Exported%20image%2020251206152051-3.png)  

**分布式网关**  
在开启本地代理ARP的场景下，VTEP只需要维护本地的ARP表项，其他VTEP通过BGP EVPN路由传递的ARP信息在转发时并不会被用到，此时VTEP无需维护从其他VTEP学习到的ARP表项。  
开启分布式网关之后，VTEP只处理收到的用户侧主机发送的ARP报文，删除已经学到的网络侧的ARP表项。

![Exported image](Exported%20image%2020251206152053-4.png)  

**MAC Mobility**  
MAC Mobility扩展属性用于当一个主机/VM从一个VTEP启动到另外一个VTEP之下时，对外宣告该主机的位置移动。

![Exported image](Exported%20image%2020251206152055-5.png)  
![Exported image](Exported%20image%2020251206152056-6.png)