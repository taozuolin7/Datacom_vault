配置思路：
1.底层IGP、LDP建立
2.构建BGP-evpn邻居
3.传递type3路由，构建
4.传递type4路由选举DF
5.传递type1路由进行水平分割防环
6.站点绑定 传递type2交互数据

## MPLS EVPN（同子网通信）
```
NE1：
#
bgp 100
 router-id 10.1.1.1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  undo peer 2.2.2.2 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 2.2.2.2 enable
#
evpn source-address 1.1.1.1  通告type3路由
#
evpn vpn-instance A
 route-distinguisher 10:10
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
interface Ethernet1/0/0
 evpn binding vpn-instance A
```

```
NE2:
#
bgp 100
 router-id 10.2.2.2
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack0
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  undo peer 1.1.1.1 enable
  undo peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 reflect-client
  peer 3.3.3.3 enable
  peer 3.3.3.3 reflect-client
#
```

```
NE3：
#
bgp 100
 router-id 10.3.3.3
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  undo peer 2.2.2.2 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 2.2.2.2 enable
#
evpn source-address 3.3.3.3
#
evpn vpn-instance B
 route-distinguisher 30:30
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
interface Ethernet1/0/1
 evpn binding vpn-instance B
```


## MPLS EVPN（不同子网通信）

![](assets/6.MPLS%20EVPN/file-20251214162400700.png)
```
NE1：
#
ip vpn-instance A
 ipv4-family
  route-distinguisher 10:10
  vpn-target 1:1 export-extcommunity evpn
  vpn-target 1:1 import-extcommunity evpn
  evpn mpls routing-enable
#
ospf 2 router-id 10.1.1.1 vpn-instance A
 import-route bgp permit-ibgp
 area 0.0.0.0
#
interface Ethernet1/0/0
 ip binding vpn-instance A
 ip address 10.1.1.254 255.255.255.0
 ospf enable 2 area 0.0.0.0
#
bgp 100
 #
 ipv4-family vpn-instance A
  import-route ospf 2
  advertise l2vpn evpn
#
```

```
NE4：
#
ip vpn-instance C
 ipv4-family
  route-distinguisher 40:40
  vpn-target 1:1 export-extcommunity evpn
  vpn-target 1:1 import-extcommunity evpn
  evpn mpls routing-enable
#
ospf 2 router-id 10.4.4.4 vpn-instance C
 import-route bgp permit-ibgp
 area 0.0.0.0
#
interface Ethernet1/0/1.1
 vlan-type dot1q 10
 ip binding vpn-instance C
 ip address 10.1.3.254 255.255.255.0
 ospf enable 2 area 0.0.0.0
#
bgp 100
 #
 ipv4-family vpn-instance C
  import-route ospf 2
  advertise l2vpn evpn
#

```


```
AR3：
#
interface GigabitEthernet0/0/0.1
 dot1q termination vid 10
 ip address 10.1.3.3 255.255.255.0 
 ospf enable 1 area 0.0.0.0
 arp broadcast enable
#
```