![](assets/4.跨域VPN-OptionB/file-20251229123322486.png)

相对于OptionA来说，更为简单
ASBR之间建立MP-EBGP邻居（VPNv4），并且关闭掉RT值的过滤，互联接口使能MPLS 标签转发功能
去除掉的配置：
	ASBR之间不需要多条链路
	ASBR之间不需要配置VPN实例
	不需要IGP于BGP的路由互相引入

控制平面：
1.PE1给CE1的路由分配私网标签，然后再分配一个公网标签传递给RR
2.RR收到后，反射给ASBR1，（并去除公网标签）E
3.ASBR1收到后，去除私网标签，重新为该路由分配一个新的私网标签。抓发给ASBR2
4.ASBR2收到后，去除私网标签，重新为该路由分配一个新的私网标签。并添加上公网标签，发给RR
5.RR收到该路由后，去去除网标签，反射给PE2
6.PE2收到该路由，分配私网标签，背CE2引入。

数据平面：
1.CE2根据路由表转发。（IP 转发）
2.PE2接收到该数据包，根据目的地址查表（dis fib），需要MPLS隧道转发，为其分配上私网标签（dis bgp vpnv4 all routing-table x.x.x.x），和公网标签发（dis mpls lsp）给下一跳RR
3.RR接收到后，去掉公网标签，传递给ASBR2，ASBR2接收到数据包后，根据下一跳，更换私网标签(dis bgp vpnv4 all routing-table x.x.x.x)，传递给ASBR1，
4.ASBR1接收到该路由后，跟换私网标签(dis bgp vpnv4 all routing-table x.x.x.x)，并打上公网标签传递给RR（dis mpls lsp），
5.RR去掉公网标签，将数据包传递给PE1。
6.PE1收到数据包后，查看对应的路由表，根据私网标签，将数据包发给对应的vpn实例。
7.CE1接收到数据包。

OptionB 会存在不同的3个私网标签：
1. PE设备会为私网路由分配一个私网标签
2. ASBR1设备会对私网标签进行替换
3. ASBR2会对从ASBR1接收到的私网标签进行替换

在VPNv4路由中，


