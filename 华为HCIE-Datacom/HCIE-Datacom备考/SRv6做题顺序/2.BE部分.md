根据我书写好的指令去做编排 达到智能选路的功能 忽略cost  
指令 告诉你 谁 需要去做什么事情  
比如 A现在
 
1.出门左转 100m  
2.再右转50m  
3.最后前行200m
 
locator定位 标记===人==找到设备  
function=opcode==事  
locator+function=sid 指令 找到某台设备的同时 还知道找到这个设备需要做什么
 
end sid 标识一台ipv6设备  
end x sid 标识一个接口 （便于编排路径，）  
end op 主要是用来业务测试  
end dt4 标识vpn实例
 
指令的集合 =segment list  
-------------------------------------------------------
   

```
segment-routing ipv6  
 encapsulation source-address FC00::1  
 locator datacom ipv6-prefix FC02:1:: 96 static 16  
  opcode ::1 end no-flavor  
  opcode ::10 end-x interface GigabitEthernet3/0/0 nexthop FE80::2 no-flavor  
  opcode ::20 end-x interface GigabitEthernet3/0/1 nexthop FE80::3 no-flavor  
  opcode ::30 end-x interface GigabitEthernet3/0/2 nexthop FE80::5 no-flavor  
  opcode ::100 end-op
```
   

```
isis  
 segment-routing ipv6 locator datacom #扩散 locator
```
   

```
bgp 65000  
rou id 2.0.0.2
```
 
```
peer FC00::5 as-number 65000  
peer FC00::5 connect-interface LoopBack0  
peer FC00::5 password cipher Huawei@123
```
 
```
peer FC00::6 as-number 65000  
peer FC00::6 connect-interface LoopBack0  
peer FC00::6 password cipher Huawei@123
```
 
```
l2vpn-family evpn  
  peer FC00::5 enable  
y  
  peer FC00::6 enable  
y
```
 
现在我们xz之间以及yz之间evpn邻居关系以及建立完毕  
如果一直卡在idle 检查一下rou id是否配置  
如果配置了  
还存在邻居关系的地址不可达
 
0.底层isis  
1.给我们网络中 每个节点的sid分配好（end end-x end-op）  
2.建立pe与pe之间 evpn邻居关系  
建立ce与pe之间 邻居关系  
pe端 部署vpn 接口绑定实例 设置实例rd  
pe端 以及ce端 部署bgp配置  
-----------目前 所有pe设备以及学习到了本段ce设备的业务地址
 
```
bgp 65000  
ipv4-family vpn-instance OA  
  advertise l2vpn evpn    /OA实例下学习到的路由 变成一份evpn路由  
但是 还是没有evpn路由  
一看 vpn实例下没有rd rt
```
 
```
ip vpn-instance OA  
 ipv4-family  
  route-distinguisher 65001:100  
  vpn-target 1:1 export-extcommunity evpn  
  vpn-target 2:2 import-extcommunity evpn
```
 
部署好了之后  
有evpn路由了吗？  
没有  
3.学习路由 发布路由 传递路由 拿到evpn路由  
bgp 65000  
ipv4-family vpn-instance OA  
segment-routing ipv6 locator datacom evpn /让OA实例基于规划好的locator生成dt4 sid并且以evpn的方式扩  
segment-routing ipv6 best-effort evpn /让OA实例基于evpn的srv6的be隧道做转发
 
---------现在 只学习到了自身的evpn路由 be起来了嘛？  
完了吗？  
没有  
让我的设备知道 我可以去传递srv6类型的evpn路由  
在  
bgp 65000  
l2vpn-family evpn  
policy vpn-target  
peer FC00::5 enable  
peer FC00::5 advertise encap-type srv6  
peer FC00::6 enable  
peer FC00::6 advertise encap-type srv6  
--此时 BE隧道已经正常工作了---  
x OA可以访问z OA  
X_Export1(10.1.0.1)访问 Z_Export1(OA:10.3.101.254)

![Exported image](Exported%20image%2020251206141826-0.png)  
![Exported image](Exported%20image%2020251206141828-1.png)  

y OA可以访问z OA
 ![Exported image](Exported%20image%2020251206141830-2.png)  
![Exported image](Exported%20image%2020251206141835-3.png)     

y RD可以访问z RD

![Exported image](Exported%20image%2020251206141837-4.png)  
![Exported image](Exported%20image%2020251206141839-5.png)  

----------------接下来去部署TE------------------
      

![Exported image](Exported%20image%2020251206141840-6.png) ![Exported image](Exported%20image%2020251206141842-7.png) ![Exported image](Exported%20image%2020251206141844-8.png) ![Exported image](Exported%20image%2020251206141845-9.png) ![Exported image](Exported%20image%2020251206141850-10.png) ![Exported image](Exported%20image%2020251206141852-11.png)