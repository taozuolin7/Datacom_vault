4.将我的转发路径编排好  
5.给路径染色  
6.给路由染色  
7.让对应的颜色的路由走对应的路  
8.修改开销  
9.qos

在xpe1设备上编排好了两条路  
segment-list XPE1-ZPE1  
index 10 sid ipv6 FC02:1::30  
index 20 sid ipv6 FC02:5::1  
segment-list XPE1-ZPE1-BK  
index 10 sid ipv6 FC02:1::10  
index 20 sid ipv6 FC02:2::30  
index 30 sid ipv6 FC02:6::10  
index 40 sid ipv6 FC02:5::1
 
但是对于设备而言 不知道哪条路是主 哪条路是备  
srv6-te policy datacom endpoint FC00::5 color 101  
candidate-path preference 200  
segment-list XPE1-ZPE1  
candidate-path preference 100  
segment-list XPE1-ZPE1-BK
 
color=标识路径  
为什么要给路由染色？ 当需求中存在多种业务时（OA，RD），让对应的路由走对应的路径（颜色）
 
让路由有颜色 让路径也有颜色  
并且 如果你的路由颜色是101 你的路径颜色是101  
两个对上 那么这个路由就会走101的路径  
路由有颜色+路径有颜色=有效转发路径（te）
 
路径染色：

![Exported image](Exported%20image%2020251206141856-0.png)  

```
路由染色：  
route-policy c101 permit node 10  
ap excommunity color 0:101
```
 
```
bgp 65000  
12vpn-family evpn  
peer Fc00::5 route-policy c101 import
```
   
![Exported image](Exported%20image%2020251206141858-1.png)  

完成te路径：  
1.路径染色  
2.路由染色

![Exported image](Exported%20image%2020251206141900-2.png)

------------------------^  
3.让设备的vpn实例支持te转发 并且优选te转发  
bgp 65000  
ipv4-fa vpn OA  
segment-routing ipv6 traffic-engineer best-effort evpn
 
```
tunnel-policy datacom  
 tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
```
 
```
ip vpn OA  
tnl-policy datacom evpn
```
 
因为：X园区没有RD业务，所有X，Y园区的配置有一点点区别  
YPE1上抓取OA业务做染色  
acl 2000  
des OA  
rule permit source 10.2.31.0 0.0.0.255  
rule permit source 10.2.32.0 0.0.0.255  
rule permit source 10.2.33.0 0.0.0.255  
rule permit source 10.2.34.0 0.0.0.255  
rule permit source 10.2.35.0 0.0.0.255
 
```
rule permit source 10.2.41.0 0.0.0.255  
rule permit source 10.2.42.0 0.0.0.255  
rule permit source 10.2.43.0 0.0.0.255  
rule permit source 10.2.44.0 0.0.0.255  
rule permit source 10.2.45.0 0.0.0.255
```
 
```
rule permit source 10.2.51.0 0.0.0.255  
rule permit source 10.2.52.0 0.0.0.255  
rule permit source 10.2.53.0 0.0.0.255  
rule permit source 10.2.54.0 0.0.0.255  
rule permit source 10.2.55.0 0.0.0.255
```
 
```
rule permit source 10.100.2.0 0.0.0.255
```
 
```
route policy c103 permit node 10  
if-match acl 2000  
apply extcommunity color 0:103  
route policy c103 permit node 100
```
 
```
bgp 65000  
12vpn-family evpn  
peer Fc00::5 route policy c103 import
```
   

```
# 迭代走TE隧道  
bgp 65000  
ipv4-fa vpn OA  
 segment-routing ipv6 traffic-engineer best-effort evpn
```
 
```
tunnel-policy datacom  
 tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
```
 
```
ip vpn OA  
tnl-policy datacom evpn  
-----OA
```
    
```
acl 3001  
 des RD  
rule permit ip source 10.2.11.0 0.0.0.255  
rule permit ip source 10.2.12.0 0.0.0.255  
rule permit ip source 10.2.13.0 0.0.0.255  
rule permit ip source 10.2.14.0 0.0.0.255  
rule permit ip source 10.2.15.0 0.0.0.255
```
 
```
rule permit ip source 10.2.21.0 0.0.0.255  
rule permit ip source 10.2.22.0 0.0.0.255  
rule permit ip source 10.2.23.0 0.0.0.255  
rule permit ip source 10.2.24.0 0.0.0.255  
rule permit ip source 10.2.25.0 0.0.0.255
```
 
```
rule permit ip source 10.3.99.0 0.0.0.255  
rule permit ip source 10.100.3.0 0.0.0.255
```
 
```
BPG 65000  
12vpn-family evpn  
peer Fc00::6 route-policy c104 import  
peer Fc00::6 route-policy c104 export
```
 
```
bgp 65000  
ipv4-fa vpn R&D  
 segment-routing ipv6 traffic-engineer best-effort evpn
```
 
```
tunnel-policy datacom  
 tunnel select-seq ipv6 srv6-te-policy load-balance-number 1
```
 
```
ip vpn R&D  
tnl-policy datacom evpn
```
   

---------

![Exported image](Exported%20image%2020251206141902-3.png)  
![Exported image](Exported%20image%2020251206141904-4.png)  
![Exported image](Exported%20image%2020251206141909-5.png)  
![Exported image](Exported%20image%2020251206141911-6.png)

-------------te都部署完成之后

![Exported image](Exported%20image%2020251206141912-7.png)  
![Exported image](Exported%20image%2020251206141914-8.png)

测试时发现  
当主路径断开 此时业务不通  
没有去切换至备份路径
 
```
bfd  
q
```

![Exported image](Exported%20image%2020251206141916-9.png)  

```
部署SBFD  
sbfd  
 reflector discriminator 5.0.0.5  
 destination ipv6 FC00::1 remote-discriminator 1.0.0.1  
te ipv6-router-id fc00::5  
se ip  
 srv6-te-policy bfd seamless enable
```
 
```
srv6-te-policy backup hot-standby enable   /激活热备份功能
```
 ![Exported image](Exported%20image%2020251206141917-10.png)  
![Exported image](Exported%20image%2020251206141919-11.png)  
![Exported image](Exported%20image%2020251206141926-12.png)     

##

![Exported image](Exported%20image%2020251206141928-13.png)  
![Exported image](Exported%20image%2020251206141930-14.png)