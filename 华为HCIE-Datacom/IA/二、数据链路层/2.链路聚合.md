\> [!caution] This page contained a drawing which was not converted.   

```
为什么要链路聚合？：  
为了保证网络的冗余性，添加设备（设备冗余），为了防止网络出现环路 配置STP。
```
 
```
为了保证网络的冗余性，添加链路（链路冗余），STP的存在，会解决环路。
```
 
```
网络转发的瓶颈是带宽，带宽可以通过增加链路获得。  
因为STP的存在，所以增加的链路认为是环路，进行阻塞，所以逻辑上没有链路增加。
```
 
```
通过链路聚合技术，来将多条物理链路变为逻辑上的一条链路，不被STP进行阻塞。  
[S1]display interface Eth-Trunk 1   查看链路聚合的状态
```
 
```
链路聚合：  
  通过虚拟化将多条物理链路，逻辑上变为一条链路  
模式：  
 1.手工模式：  
    [S1]interface Eth-Trunk 1 创建逻辑组（逻辑接口的名称）  
    [S1-Eth-Trunk1]mode manual load-balance 配置模式为手工  
    [S1-Eth-Trunk1]trunkport GigabitEthernet 0/0/2 0/0/3  将物理接口加入到逻辑组中  
    [S1-GigabitEthernet0/0/3]eth-trunk 1    物理接口加入逻辑组的第二种配置  
   
    问题：  
    1.所有加入组的物理接口，都是活跃的接口  
    2.可能出现单通问题，一端配置为链路聚合，也可以正常将接口变为up状态  
    3.在设备无法支持LACP的模式下，才会配置为手工模式
```
 
```
 2.LACP模式：动态模式(Link Aggregation Control Protocol)  
    *动态的检测，通过发送报文来协商两端的信息  
    *模式分类：  
       1.LACP静态：链路聚合协商失败，则物理端口为down  
       2.LACP动态：链路聚合协商失败，则物理端口退出链路聚合组，端口为up正常转发  
    *LACP存在活跃链路和非活跃链路（保障用户的带宽值）  
    [S1]interface Eth-Trunk 1  
    [S1-Eth-Trunk1]mode lacp-static   
    [S1-Eth-Trunk1]trunkport GigabitEthernet 0/0/2 0/0/3   
     
    需要按照需求设置最大的活跃成员链路：  
     [S1-Eth-Trunk1]max active-linknumber \<1-8\>  设置最大的活跃链路
```
 
```
活跃链路如何选择？  
根据接口的LACP优先级值进行选择  
   [S1-GigabitEthernet0/0/4]lacp priority \<0-65535\> 设置接口优先级值，默认32768  
   接口LACP优先级值是越小越优先，如果优先级值相等，则比较接口编号越小越优先  
*该比较方式，只会在第一次选举非活跃成员时比较  
   如果已经存在非活跃接口，则不需要在比较选择非活跃成员端口了
```
 
```
如果设备两端选择的非活跃链路不同，如何处理？  
      如果一端配置了非活跃链路，另一端没有配置，则按照配置的一端进行协商  
      需要进行主备设备的选举，通过主设备配置的值，进行协商
```
   

```
如何进行主备设备的选举？  
  设备通过系统优先级值 和 系统MAC地址进行对比  
  系统优先级值越小越优先   [S1]lacp priority \<0-65535\>    
   如果优先级值相等，则优先系统MAC地址越小越优先  
   主备设备可以根据优先级值的改变而变化
```
 
```
链路的抢占功能：  
     [S1-Eth-Trunk1]lacp preempt enable   要求主备设备都要开启该功能  
     [S1-Eth-Trunk1]lacp preempt delay \<10-180\>  修改抢占延迟的时间（默认30s）  
     可以让更高优先级的接口，进行抢占成为活跃链路
```
 
```
在STP中显示，不存在物理接口，只有逻辑接口  
所以不会进行设备接口的阻塞
```
 
```
问题：  
1.两条成员链路如何进行数据转发？  
  执行数据的负载分担（基于流）
```
 
```
2.如何区分一条数据流  
  [S1-Eth-Trunk1]load-balance ?  
  dst-ip       基于目标IP  
  dst-mac      基于目标MAC  
  src-dst-ip   基于源目IP（默认的方式）  
  src-dst-mac  基于源目MAC  
  src-ip       基于源IP  
  src-mac      基于源MAC
```
 
```
3.在链路聚合接口下转发的数据，如何防止环路？  
  链路聚合的接口自身存在防环机制  
  从成员接口收到的流量，不会向其他成员接口转发
```
 
```
4.链路聚合接口如何处理STP的BPDU？  
  随机一个成员接口发送STP的BPDU报文  
  链路聚合接口的STP角色就是发送BPDU物理接口的STP角色
```
 
```
1.基于包和基于流的负载分担有何区别？  
基于包每个数据包负载到不同的链路，有可能导致报文乱序(颗粒度更细)，  
基于流一条相同的流负载到一个相同的链路，不会发生报文乱序，但是单条流无法利用整个聚合接口的逻辑带宽。  
2.LACP模式如何选举主动端？  
系统优先级+MAC（小的优先）  
3.CSS、iStack有何优势？  
简化网络管理、提高网络可靠性、能够充分利用网络链路带宽、使用跨设备的Eth-Trunk可以构建物理上无环的网络。
```
 
![Exported image](Exported%20image%2020251206142404-0.octet-stream)

```
聚合组
```

```
成员接口和成员链路：
```

```
活动接口和活动链路：
```

```
非活动接口和非活动链路：
```

```
聚合模式:LACP，手工模式
```