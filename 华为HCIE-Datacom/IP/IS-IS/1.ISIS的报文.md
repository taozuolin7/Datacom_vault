```
ISIS的报文：  
1.hello报文，类似于OSPF的hello报文  
  *通过周期（10s）发送hello报文维护邻居  
   L1-hello：DMAC地址为：01:80:c2:00:00:14  
   L2-hello：DMAC地址为：01:80:c2:00:00:15
```

![Exported image](Exported%20image%2020251206164315-0.png)  

```
   p2p-hello：DMAC地址为：09:00:2b:00:00:05
```

![Exported image](Exported%20image%2020251206164316-1.png)

```
2.LSP报文：类似于OSPF的LSU报文  
   L1-LSP报文  
     
```

![Exported image](Exported%20image%2020251206164320-2.png)

```
     
L2-LSP
```
   

```
3.SNP报文：时序报文  
   1.CSNP报文：全时序报文，类似于OSPF的DD报文    
      L1-CSNP  
        
```

![Exported image](Exported%20image%2020251206164326-3.png)

```
      L2-CSNP  
   2.PSNP报文：部分时序报文，类似于OSPF的LSR报文、LSAck报文  
      L1-PSNP  
        
```

![Exported image](Exported%20image%2020251206164328-4.png)

```
      
```
 
```
L2-PSNP
```

```
ISIS报文组成结构：  
1.报文头部（通用报头）  
   每一种报文都会携带的信息                                                                                  
   图1
```
 
```
2.报文内容（专用头部）  
   每一种报文单独携带的信息  
   通过TLV的架构来携带参数信息  
   T：type 表示要描述信息  
   L：length 表示描述信息的长度  
   V：value 表示信息的具体内容  
     
  TLV架构具备极强的扩展性和易读能力
```

```
图 1
```

![Exported image](Exported%20image%2020251206164329-5.png)  

```
OSPF的Hello包：发现，建立，维护邻居
```

![Exported image](Exported%20image%2020251206164331-6.png)

```
OSPF中DD报文携带摘要信息，通过摘要信息进行信息交互
```

```
OSPF通过DD报文后，两端信息没有同步，进行LSR
```

```
在广播网络中ISIS如何交互报文，完成LSDB同步？  
AR1和AR2通过hello报文建立邻居关系后，  
会直接发送LSP报文，将自身所有的状态信息进行携带，和对方进行LSDB同步
```
 
```
如何判断AR2接收了AR1发送的LSP报文，并进行了LSDB同步？  
1.广播型网络中的设备会进行DIS（指定中间系统）的选举￼
```

![Exported image](Exported%20image%2020251206164333-7.png)

```
2.由DIS通告CSNP报文
```
 
```
DIS如何选举？DIS通告的CSNP报文存在什么参数？  
1.先比较设备的接口优先级，越大越优先  
   [AR1-GigabitEthernet0/0/0]isis dis-priority 0-127  默认值为64  
    
2.优先级值相等，则比较设备的MAC地址越大越优先  
*DIS会整合所有收到的LSP报文，并将携带的链路状态整合为摘要，放入CSNP报文周期（10s）通告  
 依次广播型网络中的所有设备都会周期接收CSNP报文，并查看是否携带了自身了LSP摘要
```
   

```
新加入设备到广播型网络中，如何同步LSDB？  
  新加入设备AR3接入网络后，会发送自身的LSP报文  
  LSP报文会泛洪到广播型网络中的所有设备
```

![Exported image](Exported%20image%2020251206164335-8.png)  

```
广播型网络中的设备收到LSP报文后的处理：  
  1.非DIS设备（AR2），收到AR3-LSP报文后，将LSP信息加入到自身的LSDB，但是不计算路由条目  
  2.DIS设备（AR1），收到AR3-LSP报文后，将LSP信息加入到自身的LSDB中，并将LSP的链路状态整合为摘要  
    放入自身周期通告的CSNP报文中，且自身可以计算LSP的路由信息
```
 
```
CSNP报文在广播型网络中泛洪，设备收到CSNP报文的处理：  
  1.非DIS设备（AR2），收到CSNP报文后，检查报文中是否携带 提前保存的AR3-LSP摘要  
       1.如果存在，则AR2正常用其计算路由条目  
       2.如果不存在，则AR2不计算路由条目  
  2.新加入设备（AR3），收到CSNP报文后，检查报文中的摘要信息  
       1.携带的摘要信息，是否有和自身通告的LSP对应  
              1.如果有，不需要进一步处理  
              2.如果没有，需要AR3自身重新发一次LSP报文  
       2.携带的摘要信息，是否存在自身没有的LSP  
              1.如果没有，不需要进一步处理  
              2.如果有，需要发送PSNP报文进行请求
```
 
```
收到PSNP报文后，设备的处理：  
  1.非DIS设备（AR2），收到PSNP报文后，不处理  
  2.DIS设备（AR1），收到PSNP报文后，回复LSP报文
```

![Exported image](Exported%20image%2020251206164337-9.png)  

```
不需要考虑LSP报文确认的问题，因为CSNP是周期发送的，所以每10s会进行一次同步
```

```
OSPF中接口优先级为0的设备不会参加DR，BDR的选举￼而ISIS中接口优先级为0的设备会参加DIS的选举
```

```
ISIS的状态机：  
1.down：接口没有使能ISIS  
2.init：接收到邻居的hello报文，但报文中不存在自身的MAC地  
3.UP：接收到邻居的hello报文，且报文中存在自身的MAC地址
```

```
DIS设备的特点：  
1.DIS是可以抢占的  
  DIS通告的CSNP报文中只携带摘要信息，广播型网络中的任意设  
备都可以执行CSNP报文的通告  
2.DIS的hello是周期10/3s发送的  
3.DIS和非DIS之间两两建立邻居关系（邻接关系）  
4.DIS选举的优先级值（0 依然可以参与选举）
```

```
OSPF中DR为什么不能被抢占呢？￼1.DR抢占后会产生2类的LSA，其中携带拓扑信息，意味着网络结构改变了
```

```
P2P网络中邻居的建立过程：  
down：发送的hello报文，报文的p2p adj state的值为down
```

![Exported image](Exported%20image%2020251206164341-10.png)  

```
init：收到了邻居的hello报文，但是报文的p2p adj state不存在自身的system id
```

![Exported image](Exported%20image%2020251206164343-11.png)  

```
up：收到了邻居的hello报文，且报文的p2p adj state存在自身的system id
```

![Exported image](Exported%20image%2020251206164345-12.png)  

![Exported image](Exported%20image%2020251206164347-13.png)

```
在P2P网络中ISIS如何交互报文，完成LSDB同步？  
邻居建立完成后，AR1会直接将自身所有的链路状态通过LSP报文向对方AR2同步
```
 
```
AR2收到LSP报文后，会回复一个PSNP报文，进行LSP报文的确认  
PSNP报文确认完成后，则表示LSDB同步完成
```

![Exported image](Exported%20image%2020251206164348-14.png)  

```
LSDB同步完成后，P2P两端会发送CSNP报文，报文内包含自身LSDB中所有LSP的摘要  
CSNP报文只有在邻居第一次建立时会发送，后续增加LSP不会发送CSNP报文
```
 
```
如果后续存在新的LSP需要同步：  
新增加LSP的设备会发送LSP报文给对端，对端收到后回复一个PSNP报文进行确认  
不需要在通过CSNP报文进一步确认
```

```
DIS特点5：P2P网络中不会进行DIS的选举，所有没有周期通告CSNP报文的设备
```