![Exported image](Exported%20image%2020251206164355-0.png) ![Exported image](Exported%20image%2020251206164400-1.png)

```
ISIS-LSDB同步：  
每台设备都会产生 描述自身的实节点LSP  
如果设备是DIS 同时也会产生描述伪节点的LSP  
如果设备引入了外部路由 也会产生分片的LSP
```
 
```
对于每一种LSP都存在L1 和 L2 两种级别
```
 
```
L1的LSP在L1的LSDB中同步  
L2的LSP在L2的LSDB中同步
```

```
在ISIS-LSDB同步完成后，如何实现L1设备 和 L2设备之间的通信？  
   路由相互学习，完成通信  
L1和L2设备之间的路由如何相互学习？  
   LSP信息同步，完成了路由学习  
L2设备如何学习L1的LSP（路由）？  
   L2设备通过L1/2设备学习到L1的LSP  
L1/2设备如何将L1的LSP 给到 L2设备？  
   L1/2设备通过L1-LSP学习到的路由信息，将路由信息整理后  （默认的路由渗透 L1到L2）  
   挂载到自身L2-LSP上，通告L2的邻居  
   ***L2设备通过明细路由访问L1设备
```
 
```
L1设备如何学习L2的LSP（路由）？  
   L1设备通过L1/2设备学习到L2的LSP  
L1/2设备如何将L2的LSP 给到 L1设备？  
   L1/2设备产生的L1-LSP中不包含任何L2的路由信息  
   但是L1/2设备产生的L1-LSP会存在ATT bit置位  
ATT bit的作用？  
   L1设备收到ATT bit置位的L1-LSP时，会产生ISIS的缺省路由  
   ***L1设备通过缺省路由访问L2设备  
ATT bit置位的条件？  
   L1/2设备收到不同区域的L2-LSP时，产生的L1-LSP会存在ATTbit置位（验证1）
```
 
```
因为缺省路由是L1/2设备产生的ATT bit，所以L1设备计算的缺省路由下一跳就是L1/2设备  
使用缺省路由的问题：  
   L1设备计算的缺省路由，只会计算到L1/2设备，不会计算L2区域的路径  
   所以可能会产生次优路径的问题（就是OSPF特殊区域的次优问题）（验证2）  
   ***ISIS的L1区域就是OSPF的特殊区域
```

```
（验证1）当所有设备都在同一个区域：
```

![Exported image](Exported%20image%2020251206164403-2.png)

```
1.查看ISIS-LSDB，发现ATT没有置位，说明没有发生L2设备的LSP信息转换为L1-LSP信息
```

![Exported image](Exported%20image%2020251206164405-3.png)  

```
2.当存在不同区域的L2设备时：
```

![Exported image](Exported%20image%2020251206164407-4.png)

```
3.ATT置位
```

![Exported image](Exported%20image%2020251206164409-5.png)  

```
（验证2）区域1访问区域2产生次优路径：  
1.拓扑图如下，AR2的出接口的cost=20
```

![Exported image](Exported%20image%2020251206164410-6.png)

```
2.查看AR1到4.4.4.4的路由：￼负载分担，产生次优路径
```

![Exported image](Exported%20image%2020251206164413-7.png)

```
如何解决L1访问的次优问题？  
   1.修改L1设备的接口开销  
   2.修改下一跳的权重值  [AR1-isis-1]nexthop 10.1.13.3 weight \<1-254\>  
                         默认情况下下一跳不存在权重值，值越大越优先  
   3.L1/2设备通告的L1-LSP不设置ATT bit置位  [AR2-isis-1]attached-bit advertise never   
   4.出现次优路径的问题是L1设备使用了缺省路由，如果L1设备存在明细路由是否可以直接解决次优路径？  
      L1设备如何存在明细路由？  
         L1/2设备将L2的LSP（路由） 引入到 L1区域中  （称之为路由渗透/路由泄露）  
         [AR2-isis-1]import-route isis level-2 into level-1 
```
 
```
     路由渗透的原理：  
         L1/2设备将 L2-LSP携带的路由信息，通过自身L1-LSP进行携带通告给L1的邻居  
         L1-LSP携带的路由开销 就是L1/2设备通过L2-LSP达到L2设备的开销
```
 
```
     **ISIS L1的LSP 优于  L2的LSP（验证3）
```
 
```
路由渗透的问题：  
   当存在多台L1/2设备时（AR2、AR3），AR2执行了L2到L1的路由渗透（图示1）  
   AR3可以在L1区域学到4.4.4.4/32，也可以在L2区域学习到4.4.4.4/32  
   根据LSP的优选规则，所以AR3优选L1的LSP访问（以此形成次优路径）
```
 
```
路由渗透次优问题的解决：  
   L1/2设备执行路由渗透后，会将渗透后产生的LSP添加 U/D bit （置0 可以计算路由 ， 置1不能计算路由）（图示2）  
U/Dbit的作用：  
   L1设备收到带有U/D bit置位的LSP，忽略U/D bit正常计算路由  
     
L1/2设备收到带有U/Dbit的L1-LSP时：  
       1.在L2区域中存在对应的L2-LSP携带相同的路由信息，不会计算其对应的路由信息，也不会在将L1-LSP渗透到L2区域中
```

![Exported image](Exported%20image%2020251206164418-8.png)

```
       2.在L2区域中不存在对应的L2-LSP携带相同的路由信息，计算其对应的路由信息，不会将L1-LSP渗透到L2区域中
```

![Exported image](Exported%20image%2020251206164420-9.png)

```
AR6中不存在对应L2-LSP信息
```
 
```
    **ISIS L2的LSP 优于 L1中U/D bit置位的LSP
```
 
```
为了保障L1设备按照最优路径访问L2区域，所以存在的所有L1/2设备都需要执行路由渗透
```
 
```
路由渗透执行完成后，L1/2设备下发的L1-LSP中ATT bit是否还置位？  
    ATT bit还置位，L1设备依然可以计算缺省路由
```
 
```
如果执行了路由渗透，则L1/2设备下发的缺省路由没有任何意义，只能作为明细的路由的备份
```

```
（验证3） 拓扑图如下：  
1.AR1和AR4都存在10.1.4.1/32的环回口，    那么AR2会学习谁的？
```

![Exported image](Exported%20image%2020251206164422-10.png)

```
2.在AR2上查看10.1.4.1/32的路由信息，与接口开销无关￼
```

![Exported image](Exported%20image%2020251206164423-11.png)

```
（图示1）在模拟器上无法重现次问题，因为以及解决了次优问题
```
 
![Exported image](Exported%20image%2020251206164425-12.png)

```
（图示2）U/D 置位：
```

![Exported image](Exported%20image%2020251206164427-13.png)

```
ISIS-LSP更新和撤销：￼1.更新
```

![Exported image](Exported%20image%2020251206164429-14.png)  

```
2.撤销：把AR4的4.4.4.4-undo isisi enable
```

![Exported image](Exported%20image%2020251206164433-15.png)