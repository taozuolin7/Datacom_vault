```
ISIS不区分内部外路由（计算的ISIS路由，协议都是 ISIS-L1/ISIS-L2）  
（验证1）  
对于路由信息都是当作叶子，挂载到LSP上：  
  1.ISIS对于外部路由使用分片LSP进行表示  
  2.ISIS设备对于分片LSP的处理 和 实节点携带路由信息的处理一样  
  3.分片LSP携带的开销和实节点携带的开销处理操作一致（叠加计算开销）  
  4.L1/2设备也会将分片LSP执行路由渗透的操作  
***ISIS在路由通告时，通告TLV 128  携带内部的路由信息 ，通过TLV 130 携带外部的路由信息
```

![Exported image](Exported%20image%2020251206164437-0.png)  
![Exported image](Exported%20image%2020251206164439-1.png)  

```
***ISIS内部的路由 优于 ISIS的外部路由 
```

![Exported image](Exported%20image%2020251206164441-2.png)  
![Exported image](Exported%20image%2020251206164443-3.png)  

```
（验证1）：  
1.ISIS不区分内部外路由
```

![Exported image](Exported%20image%2020251206164445-4.png)

```
2.分片L2-LSP携带外部路由信息
```

![Exported image](Exported%20image%2020251206164447-5.png)  
![Exported image](Exported%20image%2020251206164452-6.png)
   

```
拓扑如下：
```

![Exported image](Exported%20image%2020251206164454-7.png)

```
同时问题也来了：￼AR5会学习哪个100.5.5.5呢？是自己的还是通过ISIS学习到的AR1的100.5.5.5？  
答案是：通过ISIS学习到的AR1的100.5.5.5/32
```

![Exported image](Exported%20image%2020251206164455-8.png)

```
原因是：ISIS计算路由的优先级Pre=15，然而ISIS引入外部路由的优先级Pre=64，  
所以说AR5还是选择ISIS静态计算的。  
解决办法：￼再映入外部路由时，设置优先级为10
```

![Exported image](Exported%20image%2020251206164457-9.png)  
![Exported image](Exported%20image%2020251206164459-10.png)  

```
问题又又来了，AR4会选择谁呢？再当前这种优先级下：￼答案是：通过ISIS学习AR1的100.5.5.5/32，这是为什么呢？因为内部的优于外部的！
```

![Exported image](Exported%20image%2020251206164501-11.png)

```
外部路由的更新和撤销：￼ 更新1：
```

![Exported image](Exported%20image%2020251206164503-12.png)

```
更新2：
```

![Exported image](Exported%20image%2020251206164508-13.png)

```
￼撤销1：
```

![Exported image](Exported%20image%2020251206164510-14.png)

```
撤销2：
```

![Exported image](Exported%20image%2020251206164512-15.png)

```
ISIS的cost：  
 1.开销风格  
 *窄风格：设备接口开销bit长度为6 ，最大值是63  
           设备路由开销bit长度为10，最大值是1023  
    如果路由携带的开销计算超出了1023，则按照1023的开销计算  
    TLV 128 携带内部路由   TLV 130 携带外部路由   TLV 2 携带邻居信息
```
 
```
  *宽风格：设备接口开销bit长度为24，最大值是16777214  
           设备路由开销bit长度为32，最大值是4294967295  
   在ISIS视图下进行开销风格的改变：[AR4-isis-1]cost-style wide  
    TLV 135 携带路由信息（不区分内外部路由）   TLV 22 携带邻居信息
```
 
```
  *窄风格 和 宽风格 发送LSP中TLV的值是不同，所以两者之间无法正常同步LSP  
   所以要求在风格改变时，所有ISIS设备都要配置相同的开销风格  
                         接收              发送  
   1.窄风格（默认的）    窄                 窄  
   2.窄兼容              窄/宽              窄  
   3.兼容风格            窄/宽              窄/宽  
   4.宽风格              宽                 宽  
   5.宽兼容              窄/宽              宽
```
 
```
 2.开销类型  
   1.internal（内部引入）  
   2.external（外部引入），默认的类型
```
 
```
   如果开销风格是窄开销：   则 internal引入 优于 external引入  
     1.[AR5-isis-1]import-route static cost-type internal             
internal引入的外部路由则生成分片LSP的开销值为0
```
 
```
     2.[AR5-isis-1]import-route static cost-type internal cost 60     
internal引入的外部路由指定开销值，则生成分片LSP的开销值为指定开销值
```
 
```
     3.[AR5-isis-1]import-route static cost-type external            
 external引入的外部路由则生成分片LSP的开销值为64
```
 
```
     4.[AR5-isis-1]import-route static cost-type external cost 60     
external引入的外部路由指定开销值，则生成分片LSP的开销值为64+指定开销值
```
 
```
   如果开销风格是宽开销：  internal引入 和 external引入 操作相等  
     1.[AR5-isis-1]import-route static cost-type internal            
 internal引入的外部路由则生成分片LSP的开销值为0
```
 
```
     2.[AR5-isis-1]import-route static cost-type internal cost 60     
internal引入的外部路由指定开销值，则生成分片LSP的开销值为指定开销值
```
 
```
     3.[AR5-isis-1]import-route static cost-type external            
 external引入的外部路由则生成分片LSP的开销值为0
```
 
```
     4.[AR5-isis-1]import-route static cost-type external cost 60    
 external引入的外部路由指定开销值，则生成分片LSP的开销值为指定开销值
```

![Exported image](Exported%20image%2020251206164514-16.png)

```
ISIS的汇总：
```

![Exported image](Exported%20image%2020251206164516-17.png)  

```
区域内的路由汇总 [AR5-isis-1]summary 5.5.5.0 255.255.255.252 level-2（默认汇总路由的级别为L2）  
 1.可以在路由通告的设备上执行路由汇总  
     1.明细路由所在的设备(AR5)  
     2.在执行路由渗透后的L1/2设备上（需要判断是否修改汇总路由的级别）(AR2,AR3)
```
 
```
 2.明细路由和汇总路由的关系  
     1.如果明细路由全部失效，则汇总路由也会失效  
     2.执行汇总的设备，存在明细路由，但是不存在汇总路由 （只会生成汇总的LSP，进行通告）  
     3.汇总路由会继承明细路由最小的开销值
```
 
```
 3.针对于路由汇总的操作，可以执行多次，明细路由所在的设备汇总后，在L1/2设备依然可以执行汇总  
***执行汇总的时候，最后要加上级别（L1，L2，默认级别是L2）标记LSP信息来自哪个区域
```

```
ISIS的外部路由：  
在外部路由引入时，需要指定引入路由的级别  
如果设备是级别L1/2设备，则需要指定引入路由的级别为L1/2  
如果L1/2设备单独指定引入路由的级别为L2，就是该L1/2设备执行了路由渗透，也不会将引入的L2-LSP渗透到L1区域中
```
 
```
外部路由汇总：  
  和区域内的路由汇总方式相同   [AR5-isis-1]summary 100.5.5.0 255.255.255.0   
  执行外部路由引入的设备 可以执行外部路由的汇总（所有外部路由被汇总为一条路由时，分片LSP删除，通过实节点LSP携带汇总的路由信息）  
  执行了路由渗透的L1/2设备 可以执行外部路由的汇总（和内部路由的汇总方式、原理都一样）  
 再次体现**ISIS不区分内外部路由
```

```
如果存在多个L1/2设备，只有一台L1/2设备执行了路由汇总，是否会被其他L1/2设备进行LSP的回传？  
   不会，L1/2设备因为做了路由渗透，所以才能实现路由汇总（即汇总路由的 U/Dbit会置位）
```

![Exported image](Exported%20image%2020251206164518-18.png) ![Exported image](Exported%20image%2020251206164520-19.png) ![Exported image](Exported%20image%2020251206164524-20.png)