```
堆叠、集群：多虚一（将多台物理设备虚拟为一台逻辑设备）  
            虚拟后的设备，会将所有物理设备的控制平面合一  
            虚拟后的设备，会将所有物理设备的转发平面合一
```
 
```
堆叠：istack，支持盒式交换机的多虚一，最大支持16台  
集群：CSS，支持框式交换机的多虚一，最大支持2台
```

```
堆叠的组建方式：  
1.业务口堆叠（不专用）  
   通过建立逻辑堆叠端口来绑定物理接口
```
 
```
2.堆叠卡堆叠（专用）  
   直接通过专用线路链接专用物理接口堆叠
```

```
堆叠分裂：  
1.检测堆叠分裂问题  
   通过MAD检测（多主检测）Multi-Active Detection  
    1.直连检测：在直连检测方式中，堆叠系统正常运行时，不发送MAD报文；  
                堆叠系统分裂后，分裂后的两台交换机以1秒为周期通过检测链路发送MAD报文进行多主冲突处理  
        1.直连交换机检测：所有堆叠设备链接直连交换机，将链路作为MAD检测链路
```

![Exported image](Exported%20image%2020251206164738-0.png)

```
        2.全互联检测Full-mesh：所有堆叠设备两两互联，将链路作为MAD检测链路
```

![Exported image](Exported%20image%2020251206164743-1.png)

```
    2.代理检测：堆叠系统正常运行时，不发送MAD报文；  
                堆叠系统分裂后，分裂后的两台交换机以1秒为周期通过检测链路发送MAD报文进行多主冲突处理  
        1.单机代理检测：通过业务设备做MAD检测（业务链路作为MAD检测链路）
```

![Exported image](Exported%20image%2020251206164745-2.png)

```
        2.堆叠系统互为检测：堆叠系统之间相互进行MAD检测（业务链路作为MAD检测链路） 最好的
```

![Exported image](Exported%20image%2020251206164746-3.png)

```
2.解决堆叠分裂问题  
    分裂后进行MAD的竞选（优选优先级值priority大的，再优选MAC地址小的）  
     1.竞选成功的，堆叠系统正常运行  
     2.竞选失败，关闭所有接口（除了手工保留的接口除外）
```

```
堆叠设备01￼# 进入系统视图  
\<HUAWEI\> system-view  
[HUAWEI]
```
 
```
# 设置成员编号为 1  
[HUAWEI] stack slot 0 renumber 1
```
 
```
# 设置优先级为 200（数值越高，优先级越高）  
[HUAWEI] stack slot 0 priority 200
```
 
```
# 进入堆叠端口 0/1 视图（假设使用该端口）  
[HUAWEI] interface stack-port 0/1  
# 将物理端口 XGigabitEthernet0/0/1 加入堆叠端口 0/1  
[HUAWEI-stack-port0/1] port interface XGigabitEthernet0/0/1 enable  
[HUAWEI-stack-port0/1] shutdown interface XG0/0/1 
```
 
```
# 进入堆叠端口 0/2 视图（假设使用该端口）  
[HUAWEI] interface stack-port 0/2  
# 将物理端口 XGigabitEthernet0/0/2 加入堆叠端口 0/2  
[HUAWEI-stack-port0/2] port interface XGigabitEthernet0/0/2 enable  
[HUAWEI-stack-port0/2] shutdown interface XG0/0/2
```
 
```
###等待备设备配置好堆叠后：打开两个堆叠口  
# 进入堆叠端口 0/1 视图  
[HUAWEI] interface stack-port 0/1  
[HUAWEI-stack-port0/1] undo shutdown interface XG0/0/1 
```
 
```
# 进入堆叠端口 0/2 视图  
[HUAWEI] interface stack-port 0/2  
[HUAWEI-stack-port0/2] undoi shutdown interface XG0/0/2
```
 
```
配置完后：备设备自动重启
```

![Exported image](Exported%20image%2020251206164748-4.png)     

```
主备切换命令：  
[Huawei] slave switchover
```
 
```
拆堆叠：  
[Huawei] reset stack-configuration
```

```
堆叠设备02￼  
# 进入系统视图  
\<HUAWEI\> system-view  
[HUAWEI]
```
 
```
# 设置成员编号为 2  
[HUAWEI] stack slot 0 renumber 2
```
 
```
# 设置优先级为 100（数值越高，优先级越高）  
[HUAWEI] stack slot 0 priority 100
```
 
```
# 进入堆叠端口 0/1 视图（假设使用该端口）  
[HUAWEI] interface stack-port 0/1  
# 将物理端口 XGigabitEthernet0/0/1 加入堆叠端口 0/2  
[HUAWEI-stack-port0/1] port interface XGigabitEthernet0/0/2 enable
```
 
```
# 进入堆叠端口 0/2 视图（假设使用该端口）  
[HUAWEI] interface stack-port 0/2  
# 将物理端口 XGigabitEthernet0/0/2 加入堆叠端口 0/1  
[HUAWEI-stack-port0/2] port interface XGigabitEthernet0/0/1 enable
```
   

![Exported image](Exported%20image%2020251206164750-5.png)

```
堆叠成员退出： ￼当主交换机退出，备份交换机升级为主交换机，重新计算堆叠拓扑并同步到其他成员交换机，指定新的备交换机，之后进入稳定运行状态。  
当备交换机退出，主交换机重新指定备交换机，重新计算堆叠拓扑并同步到其他成员交换机，之后进入稳定运行状态。  
当从交换机退出，主交换机重新计算堆叠拓扑并同步到其他成员交换机，之后进入稳定运行状态。
```

```
堆叠成员加入:￼堆叠成员加入是指向已经稳定运行的堆叠系统添加一台新的交换机：  
线加将未上电的交换机连入堆叠之后再上电启动，新加入的交换机会选举为从交换机，堆叠系统中原有主备从角色不变。  
角色选举结束后，主交换机更新堆叠拓扑信息，同步到其他成员交换机上，并向新加入的交换机分配堆叠ID  
（新加入的交换机没有配置堆叠ID或配置的堆叠ID与原堆叠系统的冲突时）。  
新加入的交换机更新堆叠ID，并同步主交换机的配置文件和系统软件，之后进入稳定运行状态。
```
 
**Huawei** **环形堆叠**