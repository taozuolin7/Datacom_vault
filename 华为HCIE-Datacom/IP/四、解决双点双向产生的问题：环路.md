```
在新老网络合并时，会进行路由的相互引入  
根据需要引入路由的设备数量 称为 单点双向 或 多点双向
```
 
```
会出现的问题：  
在执行路由相互引入时，从高优先级的一端 引入到 低优先级的一端 会引发次优路径   
同时执行双向的引入，则会引发路由回馈的问题
```
 
```
在OSPF没有引入外部路由的情况下：  
因为OSPF存在两种优先级，所以对于，其他协议优先级值， 处于 ，两种优先级值范围内的 ，路由协议 。相互引入不会存在任何问题
```

```
如果OSPF已经存在外部路由：  
需要和ISIS进行双点双向的相互引入，则会产生路由问题
```

```
拓扑如下：￼
```

![Exported image](Exported%20image%2020251206164657-0.png)

```
次优路径如何产生？(在AR1已经引入了外部路由192.168.1.1/32)  
1.AR3在ISIS下视图下，引入OSPF路由协议，如果只有AR3互相引入则不会出现问题：（路由标如图1）￼2.如果AR2在ISIS视图下引入OSPF，则会出现次优路径：
```

![Exported image](Exported%20image%2020251206164659-1.png)  

```
次优路径详细解释：  
究其原因是因为优先级，ospf映入外部路由的￼  
路由次优的问题：  
AR1引入外部路由192.168.1.1/32 （优先级值为150）  
AR3收到OSPF外部路由后，将其引入到ISIS网络中￼AR2设备可以在OSPF网络中学习到优先级值150的192.168.1.1/32  
     也可以在ISIS网络中学习到优先级值15 的192.168.1.1/32  
根据优先级值越小越优先的规则，所以AR2会优选ISIS的192.168.1.1/32  
以此AR2访问192.168.1.1/32会通过ISIS网络次优访问
```

```
路由回馈的问题：  
AR2设备可以在OSPF网络中学习到优先级值150的192.168.1.1/32  
     也可以在ISIS网络中学习到优先级值15 的192.168.1.1/32  
AR2优选ISIS的192.168.1.1/32  
如果AR2执行ISIS引入到OSPF网络，则会将192.168.1.1/32也引入到OSPF网络中
```

![Exported image](Exported%20image%2020251206164702-2.png)

```
对于设备引入的路由有什么特点？  
 *引入的路由是，协议计算的路由条目，不一定是IP路由表中最优的路由  
AR2中OSPF计算出来的4条路由，会被引入到ISIS网络中可以在AR2的分片verboseISIS中看出来，￼[AR2-ospf-1]dis ospf routing
```

![Exported image](Exported%20image%2020251206164703-3.png)

```
   
 *被引入的路由，不能在引入后的协议中更优先  
AR2在ISIS中引入OSPF，因为在AR3后面才引入的，AR3已经将192.168.1.1/32引入到ISIS中，并且优先级更高，所以AR2不会再引入192.168.1.1/32
```

![Exported image](Exported%20image%2020251206164708-4.png)

![Exported image](Exported%20image%2020251206164710-5.png)

```
在次优路径和路由回馈下会产生的问题：环路￼如果在AR1上配置192.168.1.1/32和192.168.1.2/32的路由汇总：asbr-summary 192.168.1.0/30,那么AR2学习到的就是一条汇总路由：
```

![Exported image](Exported%20image%2020251206164712-6.png)  

```
AR3依旧是在AR2之后才引入ISIS，就会学习到AR2的优先级值更高的192.168.1.0/30的路由，AR3会将该条路由信息回馈给AR1，AR1会学习到192.168.1.0/30，所以它的下一跳就会指向AR3，此时如果192.168.1.2/32不存在了，那么访问路径：AR1-AR3-AR4-AR2-AR1，形成环路。￼
```

![Exported image](Exported%20image%2020251206164713-7.png)  
![Exported image](Exported%20image%2020251206164715-8.png)

```
￼如果想消除环路，可以在AR1上配置： ip route-static 192.168.1.2/32 null 0，解决问题  
￼但是 本质上：环路的问题是：次优路径 和 路由回馈的问题所导致的，因此我们需要解决的问题是“次优路径”和“路由回馈”。
```

```
次优路径的解决方案1：  
引入时是因为OSPF的路由优先级值大，导致引入到ISIS出现了次优  
所以在AR2和AR3设备上将OSPF外部路由的优先级值设置为小于15的值  
[AR2-ospf-1]preference ase 10   
[AR3-ospf-1]preference ase 10 ￼虽然解决了再ISIS中引入OSPF时产生的次优问题，但是放方向又产生了次优：￼如果在OSPF中映入ISIS，则也会产生次优。
```

```
路由回馈的来源是：AR3将，AR2在OSPF引入ISIS网络中的所有条目，AR3又引入到AR1回去了。  
￼路由回馈问题解决：通过tag标记路由，匹配tag过滤路由
```

![Exported image](Exported%20image%2020251206164716-9.png)

```
1.AR3收到ISIS的路由（172.16.10.4/32）  
2.AR3将ISIS路由引入到OSPF网络后，打上路由标记tag 100  
3.AR2可以学习到 OSPF的路由 （172.16.10.1/32），也可以学习到（172.16.10.4/32 tag 100）  
4.AR2将OSPF路由引入到ISIS网络时，过滤掉带有tag 100的路由条目
```
   

```
解决步骤：  
1.#AR3匹配ISIS路由信息  
ip ip-prefix host index 10 permit 172.16.10.0 24 greater-equal 32 less-equal 32
```
 
```
2.#对于匹配的路由执行路由标记的配置  
route-policy ITO permit node 20   
 if-match ip-prefix host   
 apply tag 100   
#  
ospf 1 router-id 10.3.3.3   
 import-route isis 1 route-policy ITO
```
 
```
3.#拒绝AR2引入的路由条目  
route-policy ITO deny node 10 （为什么要选择10节点呢？因为node20 是大范围的）  
 if-match tag 200
```
 
```
4.#AR2上配置匹配路由标记拒绝路由的操作  
route-policy OTI deny node 10   
 if-match tag 100  
#  
route-policy OTI permit node 20   
#  
isis 1  
 import-route ospf 1 route-policy OTI 
```
 
```
5.#AR2匹配ISIS路由信息  
ip ip-prefix host index 10 permit 172.16.10.0 24 greater-equal 32 less-equal 32  
#  
route-policy OTI permit node 20   
 if-match ip-prefix host   
 apply tag 200 
```
 
```
------------------------------顺时针方向的路由回馈问题解决完毕--------------------------
```

![Exported image](Exported%20image%2020251206164718-10.png)

```
路由次优问题的解决：  
 通过改变路由优先级值来实现解决次优路径  
AR3：  
#  
route-policy pre permit node 10   
 if-match tag 400  
 apply preference 16   
#  
ospf 1 router-id 10.3.3.3   
 preference ase route-policy pre 10 
```
 
```
AR2：  
#  
route-policy pre permit node 10   
 if-match tag 100  
 apply preference 20   
#  
ospf 1 router-id 10.2.2.2   
 preference ase route-policy pre 10 
```

```
逆时针方式的路由回馈问题解决：  
AR3：  
#  
route-policy OTI deny node 10   
 if-match tag 400  
#  
route-policy OTI permit node 20   
 if-match ip-prefix host   
 apply tag 300   
#  
isis 1  
 import-route ospf 1 route-policy OTI
```
    
```
AR2：  
#  
route-policy ITO deny node 10   
 if-match tag 300  
#  
route-policy ITO permit node 20   
 if-match ip-prefix host   
 apply tag 400   
#  
ospf 1 router-id 10.2.2.2   
 import-route isis 1 route-policy ITO
```

```
[AR3-ospf-1]default cost inherit-metric   继承被引入协议的路由开销  
[AR2-isis-1]import-route ospf 1 inherit-cost route-policy OTI   继承被引入协议的路由开销
```

```
图1
```

![Exported image](Exported%20image%2020251206164723-11.png)  

```
AR3在AR2之后引入OSPF
```

```
4tag主要是预防，
```

![Exported image](Exported%20image%2020251206164725-12.png)

```
只走同一个路由协议，优于 跨多个路由协议
```

a