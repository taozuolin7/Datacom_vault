# MPLS CSC VPN：运营商承载运营商的专用组网技术

**MPLS CSC VPN** 的全称是 **Carrier Supporting Carrier VPN**，直译是**运营商承载运营商 VPN**，是一种基于 MPLS L3VPN 的增强型技术，核心目的是让**小型运营商（客户运营商，CP）** 租用**大型骨干运营商（骨干运营商，SP）** 的 MPLS 网络，来承载自身的 VPN 业务，无需自建跨区域骨干网络。

简单来说，CSC VPN 是 **“VPN 嵌套 VPN”** 的典型应用，解决了中小运营商、超大型企业集团的**多级组网、跨域隔离**需求。

## 核心应用场景

1. **中小运营商组网**：中小运营商没有全国骨干网，租用电信、联通等骨干运营商的 MPLS 网络，为自己的企业客户提供跨城市 / 跨省份的 VPN 服务。
2. **超大型企业多级 VPN**：集团总部→省级分公司→市级分公司的三层架构，省级分公司作为 “二级运营商”，借助总部骨干网承载市级分公司的 VPN 业务。
3. **跨国企业组网**：企业租用全球骨干运营商的网络，在不同国家 / 地区的分支之间建立隔离的 VPN 通道。

## 网络角色划分

CSC VPN 网络分为两层运营商，设备角色清晰区分：

|角色|所属方|功能|
|---|---|---|
|**骨干运营商（SP）**|提供骨干 MPLS 网络的大型运营商（如电信）|负责转发客户运营商的 VPN 流量，不感知客户运营商的最终用户路由|
|**客户运营商（CP）**|租用 SP 网络的中小运营商 / 企业集团|负责管理自己的最终用户（CE），向 SP 申请 VPN 承载服务|
|**SP-PE**|骨干运营商|骨干网的边缘路由器，为客户运营商分配 VRF，建立 MP-BGP 邻居|
|**CP-PE**|客户运营商|客户网的边缘路由器，作为**SP 的 CE 设备**接入 SP-PE，同时向自身客户 CE 发布路由|
|**CP-CE**|客户运营商的最终用户|普通企业用户路由器，仅与 CP-PE 交互路由|

## 两种核心实现模式

根据路由传递和标签处理方式，CSC VPN 分为 **分层 PE 模式** 和 **HoVPN 嵌套模式**，这也是 HCIE 数通认证的核心考点。

### 1. 分层 PE 模式（最常用）

- **核心原理**：客户运营商（CP）的 PE 设备，直接作为骨干运营商（SP）的**CE 设备**接入 SP 网络。
- **标签处理**：两层标签嵌套
    - 内层标签：由 CP-PE 分配，对应 CP 的最终用户 VPN 路由；
    - 外层标签：由 SP-PE 分配，对应 CP-PE 在 SP 网络中的私网路由；
    - SP 网络仅转发外层标签，不感知内层标签，保证 CP 的 VPN 业务隔离。
- **特点**：SP 和 CP 的网络完全解耦，CP 可以自主管理自身的 VPN 策略，SP 仅提供传输通道。

### 2. HoVPN 嵌套模式

- **核心原理**：CP 的 VPNv4 路由直接在 SP 网络中传递，SP-PE 作为 CP 的**超级 PE（Super PE）**，CP-PE 作为**用户 PE（User PE）**。
- **标签处理**：CP-PE 将 VPNv4 路由传递给 SP-PE，SP-PE 为这些路由分配新的 VPN 标签，在 SP 网络中以 “双层私网标签” 转发。
- **特点**：SP 需要感知 CP 的 VPNv4 路由，耦合度较高，仅适用于 SP 和 CP 深度合作的场景。

## CSC VPN 与普通 MPLS L3VPN 的核心区别

| 对比维度 | 普通 MPLS L3VPN      | MPLS CSC VPN               |
| ---- | ------------------ | -------------------------- |
| 网络层级 | 单层：运营商→最终企业用户      | 双层：骨干运营商→客户运营商→最终用户        |
| 角色数量 | 仅包含 SP、PE、CE       | 包含 SP、CP、SP-PE、CP-PE、CP-CE |
| 路由传递 | 直接传递最终用户的 VPNv4 路由 | 传递客户运营商的 VPNv4 路由（嵌套转发）    |
| 适用场景 | 单一企业跨域组网           | 运营商租用骨干网、多级企业组网            |

## 关键技术特点

1. **强隔离性**：不同客户运营商（CP）的流量在骨干运营商（SP）网络中完全隔离，标签嵌套机制保证业务数据不泄露。
2. **高扩展性**：骨干运营商无需关注客户运营商的内部 VPN 配置，CP 可以自主扩展用户数量和 VPN 业务。
3. **成本优化**：中小运营商 / 企业无需自建骨干网，大幅降低跨域组网的建设和维护成本。
4. **兼容性强**：完全兼容 MPLS L3VPN 的标准协议（BGP/MPLS VPNv4），无需额外部署新协议。

## HCIE 实验配置核心要点

1. **骨干 SP 侧配置**：SP-PE 上创建对应 CP 的 VRF，将 CP-PE 的互联接口划入该 VRF，与 CP-PE 建立 EBGP 邻居，传递 CP 的 VPNv4 路由。
2. **客户 CP 侧配置**：CP-PE 与自身的 CP-CE 建立 IGP/BGP 邻居，引入用户路由；同时与 SP-PE 建立 BGP 邻居，发布 VPNv4 路由。
3. **标签验证**：通过 `display mpls lsp` 查看双层标签的分配情况，通过 `display bgp vpnv4 all routing-table` 验证路由传递是否正常。