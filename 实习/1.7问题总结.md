# 公私 AS号
1.公私网AS号
1-64495
64512-65535
65535-4199999999
42亿-42.9亿
# 2.扩展团体属性（RT）
**RT（Route Target，路由目标）** 是 BGP 的**扩展团体属性**之一，长度为**64 位**（8 字节），主要用于在 MPLS VPN 网络中**控制 VPN 路由的分发**，决定哪些路由可以被导入到特定的 VRF（虚拟路由转发）实例中。

RT 与 RD（Route Distinguisher，路由区分符）格式相同，但功能完全不同：

- RD：用于使 VPNv4 地址在全局唯一，解决地址重叠问题
- RT：用于路由的导入导出控制，实现 VPN 成员资格标识

## 二、核心作用

RT 的核心作用是实现**VPN 路由的精确控制**，主要体现在两个方面：

|类型|作用|应用场景|
|---|---|---|
|**Export RT（导出 RT）**|本地 PE 将从 CE 学到的路由导出到 MP-BGP 时，为路由打上的标签|标识该路由属于哪个 VPN 实例|
|**Import RT（导入 RT）**|本地 VRF 实例配置的用于匹配接收路由的 RT 值|决定哪些远程 VPN 路由可以被导入到本地 VRF 中|

通过 RT 机制，运营商可以实现：

1. **不同 VPN 之间的路由隔离**：只有 RT 匹配的路由才能互通
2. **跨 PE 的 VPN 路由传递**：PE 之间通过 MP-BGP 传递带 RT 标签的 VPNv4 路由
3. **灵活的 VPN 互联**：支持同一企业不同站点的互联、不同企业间的选择性互通

## 三、RT 数据格式

RT 采用**64 位**扩展团体属性格式，有三种常见表示方式：

1. **AS 号：编号格式**（最常用）
    
    - 格式：`ASN:NN`（如 65000:1）
    - 前 16 位为 AS 号，后 16 位为自定义编号（32 位总长度）
    - 扩展格式：`ASN(4字节):NN(2字节)`（支持 4 字节 AS 号）
    
2. **IP 地址：编号格式**
    
    - 格式：`IPv4地址:NN`（如 10.0.0.1:100）
    - 前 32 位为 IPv4 地址，后 16 位为自定义编号
    
3. **二进制格式**
    
    - 完整 64 位扩展团体属性，包含**类型字段**（8 位）和**子类型字段**（8 位）
    - RT 的类型值通常为**0x0202**（即 Type 0x02, Subtype 0x02）
## 五、RT 与 RD 的关键区别

| 特性       | RT（Route Target）              | RD（Route Distinguisher） |
| -------- | ----------------------------- | ----------------------- |
| **属性类型** | BGP 扩展团体属性                    | BGP VPNv4 地址前缀的一部分      |
| **主要功能** | 路由导入导出控制                      | 使 VPNv4 地址全局唯一          |
| **配置方式** | 每个 VRF 可配置多个 Import/Export RT | 每个 VRF 只能配置一个 RD        |
| **传递方式** | 随 BGP Update 报文传递             | 作为 VPNv4 地址前缀的一部分传递     |
| **匹配机制** | 路由携带的 RT 需与 Import RT 匹配      | 无需匹配，仅用于地址唯一性           |
| **应用场景** | 控制 VPN 路由分发                   | 解决地址重叠问题                |

## 六、配置示例（华为设备）

以下是 RT 在 MPLS VPN 中的典型配置：
1. **配置 VRF 实例并指定 RT**
```
ip vpn-instance CustomerA
 ipv4-family
  route-distinguisher 65000:1  // RD配置
  vpn-target 65000:1 export     // 导出RT
  vpn-target 65000:1 import     // 导入RT（通常与导出RT相同）
```
2. **BGP 中配置扩展团体属性传递**
```
bgp 65000
 ipv4-family vpnv4
  peer 10.0.0.2 enable         // 启用对端PE的VPNv4邻居
  peer 10.0.0.2 advertise-ext-community  // 允许传递扩展团体属性（含RT）
```
## 总结
RT 是 MPLS VPN 网络中**核心的路由控制机制**，通过 Export RT 和 Import RT 的匹配实现 VPN 路由的精确分发。理解 RT 的工作原理对于设计和维护复杂 MPLS VPN 网络至关重要，它不仅能实现基本的 VPN 隔离，还能支持灵活的 VPN 互联场景。


# 3.公认必遵，公认任意，可选过度，可选非过度

公认必遵（都能识别，Update消息中必须存在）：AS-Path，Orign，Next-Hop
公认任意（都能识别，不一定会在Update消息中）：local-preference，自动聚合
可选过度（传递）（可以不支持该属性，但是可以传递该属性）：community，手工聚合
可选非传递（路由器不支持的情况，直接忽略，且不传递）：med，cluster-list，级群ID

==首先丢弃下一跳不可达的==
p：preference-value 大的
l：local-preference 大的
l：本地始发->从邻居对等体学到的：手工聚合-自动聚合-network-import-从邻居对等体学到的
a：优选as-path路径短的
o：起源属性最优的：IGP-EGP-Incomplete      i>e>?
m：med值小的
e：从EBGP邻居学习到的路由由于从IBGP邻居学习到的
n：优选下一跳开销小的
c：优选cluster-list 短的
o：优选originater-id 最小的
r：优选router-id 小的
ip：优选地址小的对等体发布的

# 4.割接前一天登录现网，看一下有没有漏掉的vpn-instance
