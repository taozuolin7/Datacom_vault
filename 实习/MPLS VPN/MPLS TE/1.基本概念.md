# 流量工程技术背景
## **IP网络的缺点**
传统的IP网络中，节点选择最短的路径作为最优路由，不考虑带宽等因素。这样的选路方式容易出现流量集中于最短路径而导致拥塞，而其他可选链路则较为空闲......
![](assets/1.基本概念/file-20260205091649153.png)
在MPLS TE出现之前，有如下两种流量工程的解决方案：
- IP流量工程：通过调整路径Metric而控制网络流量的传输路径，这种解决方法能够解决某些链路上的拥塞，但是可能会引起另外一些链路拥塞。另外，在拓扑结构复杂的网络上，Metric值的调整比较困难，往往一条链路的改动会影响多条路由，难以把握和权衡。
- ATM流量工程：现有的IGP协议都是拓扑驱动，只考虑网络的连接情况，但不能灵活反映带宽和流量特性这类动态状况。解决这种缺陷的一种方法是使用IP over ATM重叠模型。ATM流量工程采用这种重叠模型建立虚连接引导部分流量，从而容易实现流量的合理调配和良好的QoS功能。然而，实际应用中实施ATM流量工程时额外开销大且可扩展性差。

## 从网络工程到流量工程
![](assets/1.基本概念/file-20260205091649152.png)
- 网络工程是通过设计网络来满足流量需求的过程。其实质是按照流量的需求来规划、设计和部署网络的一个过程
- 流量工程是指网络节点可以根据网络中的可用资源建立数据转发路径，并具有为关键流量预留网络带宽的能力。通过动态监控网络的流量和设备的负载，实时调整流量管理参数、路由参数和资源约束参数等，优化网络资源的使用，避免负载不均导致的拥塞
- 如果将网络工程比作道路新建、改扩建的话，流量工程就是缓堵保畅

## 为什么需要流量工程
**传统IP网络**
- 传统的IP网络中，节点不考虑带宽等因素，选择最短的路径作为最优路由。这样，容易出现流量集中于最短路径而导致拥塞，其他可选的路径则较为空闲

**部署流量工程后的网络**
- 流量工程通过建立基于一定约束条件的转发路径，当流量到达路径首节点时，根据流量特征使特定的流量按照指定的路径进行传输使用流量工程，
- 网络管理员可以通过部署不同的转发路径来合理分配网络资源，避免网络拥塞
**流量工程的作用**
- 路径规划
- 流量调优
- 故障保护

# MPLS 流量工程简介
## MPLS TE 概述
- 1999年9月，RFC2702 (Requirements for Traffic Engineering Over MPLs) 详细地描述了实现基于MPLS流量工程的必要条件,为MPLS流量工程的发展和运用奠定了良好的基础。MPLS流量工程可以在不进行硬件升级的情况下对现有网络资源进行合理调配和利用，并对网络流量提供带宽和Qos保证，最大限度的节省成本。由于其基于MPLS技术实现，因此易于在现有网络部署和维护。MPLS TE是MPLS技术和流量工程的完美结合，为大型网络服务提供商核心网络和骨干网络提供了端到端的业务保障
- 在MPLS TE中，经常会把多条LSP联合起来使用，并将这些LSP与一个虚拟隧道接口关联起来，这样的一组LSP隧道称为MPLS TE隧道。MPLS TE隧道所使用的Lsp称为基于一定约束条件建立的Lsp (Constraint-based Routed Label switched Path)，简称为CR-LSP。约束条件主要包括带宽约束和路径约束两个方面，只有隧道所经过的链路满足约束条件才能成功地建立CR-LSP，凭借约束条件可以更好地根据现有网络的情况规划业务 路约束

## MPLS TE的实现方式
1.流量工程下的资源预留协议Resource Reservation Protocol - TE
- RSVP-TE是为支持流量工程而对RSVP进行的扩展
- RSVP-TE技术较为成熟，已经被规模化运用，但技术本身较为复杂，扩展性较差目前业界主要采用RSVP-TE-的方式

2.基于约束路由的标签分发协议Constraint-Routing Label Distribution Protocol
- 基于约束条件的标签分发协议，是对原有LDP的扩展
- CR-LDP技术不太成熟，==基本没有运用==，但是比较简单，扩展性较好

### RSVP-TE 
- RSVP-TE是由传统IP网络中的RSVP协议(在、FC2205中定义)基于MPLS TE隧道扩展而来，最初为RFC3209，后面依次更新为RFC3473、 RFC4875、 RFC5420
- RSVP-TE协议除继承了RSVP协议的带宽预留功能外，还支持了MPLS网络中的MPLS标签的分发功能。新增了5个对象:
	1.标签请求(LABEL_REQUEST)
	2.标签(LABEL)
	3.显式路径(EXPLICIT_ROUTE)
	4.记录路径(RECORD_ROUTE)
	5.会话属性(SESSION_ATTRIBUTE)
- 这些新增的对象除了可以携带标签信息外，还可以携带对LSR选路时的限制性要求，从而可以建立由入节点到出节点间的CR-LSP
- RSVP-TE可以为每条CR-LSP预留指定的带宽资源，以确保所建立的每条CR-LSP都有一定的带宽保障RSVP-TE与RSVP一样，只为单向的数据流请求资源，即在双向通信中，需要为双向数据流分别进行资源预留

## MPLS TE的主要功能
- MPLsTE隧道支持显式路径，可以根据实际需要，包含或不包含特定的节点
- 显式路径分为松散显式路径和严格显式路径

- MPLS TE支持LSP隧道路径上的资源预留，实现端到端的带宽保证
- MPLS TE支持LSP隧道随网络资源情况的变化而进行路径重优化
- MPLSTE支持LSP隧道随带宽变化自动进行带宽的调整

- MPLSTE支持配置CR-LSP隧道的优先级，在建立高优先级的隧道而路径上的带宽资源不足时，可以抢占其他低优先级隧道的资源

- MPLS TE支持建立面向端到端的，基于LSP的流量隧道
- MPLS TE支持预先建立备份路径的功能，备份路径的出入节点与主路径相同，当主路径故障时可切换到备份路径进行流量转发，为主路径实现端到端保护
- MPLS TE支持局部保护功能，当主路径上的链路或节点故障后，使用局部保护可以保证流量在局部快速地切换，当隧道首节点感知到故障后再切换至备份路径

- MPLs流量工程还支持一些高级的特性，来丰富基本功能:
	1.快速重路由(Fast reroute,FRR)
	2.隧道的备份(Tunnel backup)
	3.带宽的自动调整(Auto bandwidthadjustment)
	4.路径的重优化(Re-Optimum)

#### LSP隧道
对于一条LSP，一旦在Ingress节点给报文打上标签，流量的转发就完全由标签决定了。流量对LSP的中间节点是透明的，从这个意义上来说，一条LSP可以看作是一条LSP隧道。
#### MPLS TE隧道
在MPLS TE中，经常会把多条LSP联合起来使用，并将这些LSP与一个虚拟隧道接口关联起来，这样的一组LSP称为MPLS TE隧道。MPLS TE隧道涉及以下几个概念：
- 隧道接口：隧道接口是为实现报文的封装而提供的一种点对点类型的虚拟接口，与Loopback接口类似，都是一种逻辑接口。
- 隧道标识（Tunnel ID）：采用十进制数字来唯一标识一条MPLS TE隧道，以便对隧道进行规划和管理，这个数字称为Tunnel ID。
- LSP标识（LSP ID）：采用十进制数字来唯一标识一条LSP，以便对LSP进行规划和管理，这个数字称为LSP ID。

# MPLS TE的实现框架
**动态MPLS TE隧道建立的实现过程主要依靠信息发布，路径计算，路径建立和流量转发4大功能组件**
- 在网络中部署MPLS TE，需要配置链路属性和隧道属性，之后MPLS TE自动建立相应的隧道。隧道建立后，需要将流量引入隧道进行流量转发协议报文交互 
- 对于静态CR-Lsp来说，由于其是用户手工建立，因此不涉及信息发布和路经计算
![](assets/MPLS%20TE/file-20260202111339721.png)
![](assets/基于RSVP-TE建立动态CR-LSP隧道（亲和属性）/file-20260205092550350.png)


IGP（OSPF/IS-IS）的路由收敛过程：
1.建立邻居关系
2.互相通告链路状态信息
3.路径计算
4.生成路由表

MPLS TE的实现步骤：
1.通过IGP的路由表，以及路径的约束信息，生成TEDB
2.通过TEDB进行路径计算
3.路径建立
4.将流量引入LSP隧道
