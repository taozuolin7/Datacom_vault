**概述**
- MPLS TE使用CSPF算法计算出到达某个Egress节点的最优路径。
- CSPF是带有约束条件的SPF算法，从SPF算法衍生而来CSPF的计算过程就是根据MPLS TE隧道的要求，先对TEDB中的链路进行裁剪，把不满足TE属性要求的链路剪掉;然后再采用SPF算法，寻找一条到达Egress节点、满足TE属性要求的最短路径(即一组LSR地址)。CSPF计算的结果是一条满足约束条件、完全明确的路径。通常只在MPLS TE隧道的Ingress节点进行CSPF计算

**CSPF算法概述**
- IS-IS和OSPF通过SPF计算出到达网络各个节点的最短路径。MPLS TE则是使用CSPF(Constrained Shortest Path First，带有约束条件的最短路径优先)算法计算出到达某个节点的最优路径。主要根据以下信息来进行CSPF算法:
	1.Cost(IGP本身具有)
	2.带宽(链路的最大可预留带宽，BC带宽，CT带宽)
	3.链路属性(链路颜色，隧道颜色)
- CSPF算法的计算依据:
	1.待建立隧道的隧道属性，在隧道的入口处配置(带宽、显式路径、建立/保持优先级、亲和属性等约束条件)
	2.流量工程数据库TEDB(如果网络中不配置OSPFT和IS-1STE，就不能形成TEDB。这种情况下生成的CR-LSP是由IGP路由得到的，而不是CSPF计算出来的)
CSPF不存在负载分担，计算出的路径有且仅有一条

**CSPF算法的工作过程**
1.针对待建立隧道的隧道属性，先对TEDB中的链路进行裁剪，把不满足属性要求的链路剪掉2.采用SPF算法，计算出一条到隧道目的地址的最短路径
3.如果仍有多条权值相等的路径，进行tie-breaking选出最优路径

**CSPF算法的最高仲裁:Tie-Breaking**
- CSpF在计算路径的过程中，如果遇到多条权值相同的路径，将根据策略选择其中的一条。这个过程称为仲裁(tie-breaking)
- 可用的仲裁策略有:
	1.Most-fi:选择已用带宽和最大可预留带宽的比值最大的链路，使链路带宽资源高效使用
	2.Least-fl:选择已用带宽和最大可预留带宽的比值最小的链路，使各条链路的带宽资源均匀使用
	3.Random:随机选取，使每条链路上的LSP数量均匀分布，
- 不考虑带宽因素在已用带宽和最大可预留带宽的比值相同的情况下，此时不管配置的是Least-f还是Most.-fl，选择的是首先发现的链路
- Most-fill和Least-fill模式只在两条链路的带宽占用率之差超过10%时有效，如链路A带宽利用率50%，链路B带宽利用率45%二者利用率差值为5%，此时Most-fill和Least-fill模式不生效，仍用Random模式

**CSPF与SPF**
CSPF是专门用于MPLS TE路径计算的算法，它与一般的SPF算法相差不大，但又有几点区别:
	1.CSPF只计算到达隧道终点的最短路径，而SPF需要计算到达所有节点的最短路经
	2.CSPF不再使用简单的邻居间链路代价作为度量值，而使用隧道的约束条件作为度量值
	3.CSPF不存在负载分担，当两条路径有同样的权值时需要仲裁。也就是对于一条CR-LSP来说，整个LSP上始终不存在两条不同的转发路径。但一条MPLs TE隧道可以包含多条CR-LSP，多条CR-LSP之间可以负载分担

**路径选择**
- 在CR-LSP建立时由用户手工指定其必须经过(或避开)指定的节点，这个在MPLS TE中称为显式路径(Explicit Path)。显式路径由一系列节点构成，按配置的先后顺序组成一条向量路径。显式路径中的IP地址是指节点上接口的IP地址，通常采用Egress节点上Loopback接口的地址作为显式路径的目的地址
- 除了CSPF算法本身，还可以通过显式路径来控制路径的选择。支持显式路径是MPLS TE最大的魅力之一，我们可以根据实际的需求，定义LSP隧道的路径，提高可运营、可管理的能力
- 显式路径由一系列节点构成，一条显式路径上的两个相邻节点之间存在两种关系:
	1.严格下一跳(strict):两个节点必须直接相连
	2.松散下一跳(loose):两个节点之间可以存在其他路由器
- 严格方式与松散方式可以单独使用，也可以混合使用
- 通过Include/Exclude命令来控制LSP隧道经过或不经过(避开)某节点

路径选择:严格显式路径(Strict explicit path)
- 所谓的严格显式路径，就是下一跳与前一跳直接相连
- 通过严格显式路径，可以最精确(准)地控制LSP所经过的路径

路径选择:松散显式路径(Loose explicit path)
- 松散方式可以指定路径上必须经过哪些节点，但是该节点和前一跳之间可以存在其他路由器

路径选择:混合显式路径(Hybrid explicit path)
- 严格方式和松散方式可以混合使用