```R
配置SRv6基本功能
segment-routing ipv6
 encapsulation source-address 2001:DB8:1::1
 # 配置 SRv6 封装时，外层 IPv6 报文的源地址为 2001:DB8:1::1。
 locator SR1 ipv6-prefix 2001:DB8:100:: 76 static 16 args 8
  opcode ::1 end no-flavor
  opcode ::5000 end-dt4 vpn-instance vpn1 evpn # 专门用于 IPv4 私网 VPN 报文的 SRv6 解封装和终结。
  opcode ::6000 end-dt6 vpn-instance vpn1 evpn 
# args 8：指定SID中参数位（Arguments）的长度为8位——用于携带业务参数（如 VPN 实例、EVPN 标识等）。

isis 1
Ipv6 enable topology ipv6
segment-routing ipv6 locator SR1 auto-sid-disable
```
**segment-routing ipv6 locator SR1 auto-sid-disable**
这个命令会**完全禁用上述自动生成和发布 Auto-SID 的行为**，具体表现为：
1. 设备不再自动创建 Node SID、Adjacency SID 等基础 SRv6 SID；
2. IS-IS 协议不会向全网发布任何自动生成的 SRv6 SID 信息；
3. 所有需要使用的 SRv6 SID（如你之前配置的 END、END-DT4/END-DT6 等业务型 SID），都必须由管理员**手动配置**，而非依赖系统自动生成。
# 为什么要禁用 Auto-SID？（典型应用场景）

这个配置主要用于**精细化规划 SRv6 网络**的场景，常见原因包括：

1. **全网 SID 统一规划**：运营商 / 大型企业网络中，SRv6 SID 的结构（Locator/Function/Arguments 位）需要全网标准化（比如 Function 位取值对应固定功能），自动生成的 SID 可能不符合规划规则，易导致 SID 冲突或功能不匹配；
2. **减少控制面开销**：Auto-SID 会通过 IS-IS 发布，禁用后可减少 IS-IS 协议报文的大小和数量，降低网络设备的控制面负担；
3. **适配 EVPN+SRv6 组网**：在 EVPN+SRv6 场景中，SRv6 SID 主要由 EVPN 控制面（而非 IS-IS）发布，禁用 Auto-SID 可避免 IS-IS 自动生成的 SID 与 EVPN 发布的 SID 冲突；
4. **多 Locator 部署**：若设备绑定多个 SRv6 Locator（如核心域 Locator、VPN 域 Locator），自动生成的 SID 会混淆不同 Locator 的用途，禁用后可手动为不同 Locator 分配专属 SID；
5. **仅使用业务型 SID**：若网络中仅需手动配置的业务 SID（如 END-DT4/END-DT6 用于 VPN 终结），无需基础的 Node/Adjacency SID，禁用 Auto-SID 可简化配置。

```
配置BGP peer
bgp 64880
 l2vpn-family evpn
  peer 2001:DB8:5::5 enable
  peer 2001:DB8:5::5 advertise encap-type srv6 # 告诉对端邻居 “转发该 EVPN 业务报文时，必须使用 SRv6 方式封装，而不是传统的 MPLS 封装”。默认情况可能是不封装或者是封装为MPLS 
```

```
RR配置SRv6基本功能

segment-routing ipv6
 encapsulation source-address 2001:DB8:5::5
 locator SR1 ipv6-prefix 2001:DB8:150:: 76 static 16 args 8
  opcode ::1 end no-flavor
isis 1
Ipv6 enable topology ipv6        
segment-routing ipv6 locator RR1 auto-sid-disable
bgp 64880
l2vpn-family evpn
  undo policy vpn-target
  peer 2001:DB8:1::1 enable
  peer 2001:DB8:1::1 reflect-client
  peer 2001:DB8:1::1 advertise-community # **允许向指定的 BGP 邻居（2001:DB8:1::1）发布路由时，携带「团体属性」这个属性值**。
  # BGP 协议**默认不会向邻居传递团体属性**
  peer 2001:DB8:1::1 advertise encap-type srv6
```


```R
配置L3 VPN业务迁移

ip vpn-instance vpn1
 ipv4-family
  vpn-target 1:1 export-extcommunity evpn
  vpn-target 1:1 import-extcommunity evpn

bgp 64880
 ipv4-family vpn-instance vpn1
  advertise l2vpn evpn 
  3 # 命令用来使能VPN实例发布EVPN的IP前缀路由功能
  # 如果使用EVPN的IP前缀路由在设备之间传播IP路由，则需要使能VPN实例发布EVPN的IP前缀路由功能，使本端VPN实例收集的IP路由可以通过BGP EVPN对等体关系发送给对端设备。
  segment-routing ipv6 locator SR1 evpn
  # 在EVPN L3VPN场景中，如果用户希望使用SRv6隧道承载业务流量，则需要配置**segment-routing ipv6 locator evpn**命令为将要发送的EVPN路由添加SID属性。对端BGP EVPN邻居在收到EVPN路由后，可以根据路由中的SID迭代SRv6隧道，从而生成转发表项。
  segment-routing ipv6 best-effort evpn
  # 这样EVPN相关路由会迭代SRv6 TE Policy隧道，从而使业务流量通过SRv6 TE Policy隧道转发。为了进一步提升可靠性，当网络中存在SRv6 BE隧道时，可以配置best-effort参数，这样当SRv6 TE Policy隧道故障时业务可以使用SRv6 BE隧道作为逃生路径。
  bestroute nexthop-priority ipv6 high-level #  命令用来配置BGP学习的路由基于下一跳选路IPv4优先级高还是IPv6优先级高。选路顺序在比较IGP Metric前面
```